define("whiteBoard",["boardConf","enDataSend"],function(e,t,a){var o=e("boardConf").conf,n=e("enDataSend"),r={conf:{type:"stu",pauseDraw:!0,paintModule:"show",version:"old",pencil:{color:"#0078FF",size:3},rub:{size:30},sign_pencil:{color:"#FFFF00",size:20},font:{fontStyle:"songti",fontSize:32,fontColor:"#0078FF"},target:{color:"#0000FF"},canvas:{target:null,targetContext:null,targetBak:null,targetBakContext:null,width:0,height:0,left:0,top:0,teaFontC:"",teaPenC:"",teaSignPen:"",stuFonC:"",stuPenC:"",stuSignPen:""},paintBoard:{PaintBoard:null,input:null,edit:null,inputBak:null,inputBakContain:null}},recordConArr:[],orderList:[],svcId:1,binded:!1,curDrawType:"pen",colorChange:!1,colorChangeId:-1,downEvent:!1,outEvent:!1,curTarget:null,dragData:{initialLeft:0,initialTop:0},textData:{signTextDrag:!1,signREdit:!1,inputBorder:0,inputMaxWid:0,inputMaxHei:0,fontSize:0,textInput:"",lastTextInput:"",pointXTD:0,pointYTD:0,pointLeftTD:0,pointTopTD:0},mouseData:{startX:0,startY:0,nowX:0,nowY:0,endX:0,endY:0,minX:0,minY:0,maxX:0,maxY:0,pointArr:[]},initWEBTools:function(){void 0!=document.getElementById("canvas")&&(this.conf.canvas.target=document.getElementById("canvas"),this.conf.canvas.targetBak=document.getElementById("canvas_bak"),this.conf.canvas.targetContext=this.conf.canvas.target.getContext("2d"),this.conf.canvas.targetBakContext=this.conf.canvas.targetBak.getContext("2d"),this.conf.paintBoard.PaintBoard=document.getElementById("paintBoard"),this.conf.paintBoard.input=document.getElementById("input"),this.conf.paintBoard.edit=document.getElementById("edit"),this.conf.paintBoard.inputBak=document.getElementById("inputBak"),this.conf.paintBoard.inputBakContain=document.getElementById("inputBakContain"),this.conf.paintBoard.input.style.display="none",this.conf.canvas.stuFonC=o.board.stu.font.fontColor,this.conf.canvas.stuPenC=o.board.stu.pencil.color,this.conf.canvas.stuSignPen=o.board.stu.sign_pencil.color,this.conf.canvas.teaFontC=o.board.tea.font.fontColor,this.conf.canvas.teaPenC=o.board.tea.pencil.color,this.conf.canvas.teaSignPen=o.board.tea.sign_pencil.color,"tea"===o.user.type&&(this.conf.pauseDraw=!1),"draw"==this.conf.paintModule&&(r.draw(r.curDrawType),r.bind(r.conf.canvas.targetBak),r.bind(r.conf.paintBoard.input),r.binded=!0))},review:function(e,t,a,n){e=Math.round(e),t=Math.round(t),a=Math.round(a),n=Math.round(n),r.conf.paintBoard.input&&"none"!=r.conf.paintBoard.input.style.display&&r.write_end(),this.conf.canvas.target||this.initWEBTools(),console.log("[%s] -----------\x3e resize paint size: (width,height,left,top)(%d,%d,%d,%d)",window.getTimeNow(),e,t,a,n);var s=this.conf.paintBoard.PaintBoard.style,i=this.conf.paintBoard.inputBakContain.style,c=this.conf.canvas.target,l=this.conf.canvas.targetBak;s.width=e+"px",s.height=t+"px",s.left=a+"px",s.top=n+"px",i.top=n+"px",i.left=a+"px",c.width=e,c.height=t,l.width=e,l.height=t;var d=r.getOffset(r.conf.paintBoard.PaintBoard);this.conf.canvas.width=e,this.conf.canvas.height=t,this.conf.canvas.left=d.left,this.conf.canvas.top=d.top,o.classInfo.drawInfo.left=d.left,o.classInfo.drawInfo.top=d.top,o.classInfo.serverInfo.curPage==o.classInfo.textInfo.curPage&&r.repaint()},draw:function(e){if(this.conf.canvas.target||this.initWEBTools(),"back"!=e&&"clear"!=e)r.curDrawType=e;else if("back"==e){if(0!=r.orderList.length){var t=r.orderList.pop();t&&r.handle_back(t)}}else r.handle_clear()},bind:function(e){e.removeEventListener("mousedown",r.mousedown),e.removeEventListener("mousemove",r.mousemove),e.removeEventListener("mouseup",r.mouseup),e.removeEventListener("mouseout",r.mouseout),e.addEventListener("mousedown",r.mousedown,!1),e.addEventListener("mousemove",r.mousemove,!1),e.addEventListener("mouseup",r.mouseup,!1),e.addEventListener("mouseout",r.mouseout,!1)},mousedown:function(e){if(e=e||window.event||arguments.callee.caller.arguments[0],r.outEvent=!1,"draw"==r.conf.paintModule&&!r.conf.pauseDraw){var t=r.conf.canvas.targetBakContext,a=r.conf.canvas.width;r.conf.canvas.height;if("none"!=r.conf.paintBoard.input.style.display&&"text"!=r.curDrawType){var o=(e.target||e.srcElement).id;"input"!=o&&"edit"!=o&&r.write_end()}r.downEvent=!0;var n=r.getOffset(r.conf.paintBoard.PaintBoard);r.conf.canvas.left=n.left,r.conf.canvas.top=n.top,r.mouseData.startX=Math.round(e.clientX+document.body.scrollLeft-r.conf.canvas.left),r.mouseData.startY=Math.round(e.clientY+document.body.scrollTop-r.conf.canvas.top);var s=Math.round(r.conf.pencil.size*a/800);switch("rec"===r.curDrawType&&(r.mouseData.startX=r.mouseData.startX-s>=0?r.mouseData.startX:s,r.mouseData.startY=r.mouseData.startY-s>=0?r.mouseData.startY:s),r.mouseData.minX=r.mouseData.startX,r.mouseData.minY=r.mouseData.startY,r.mouseData.maxX=r.mouseData.startX,r.mouseData.maxY=r.mouseData.startY,t.strokeStyle=r.conf.pencil.color,t.lineWidth=s,t.moveTo(r.mouseData.startX,r.mouseData.startY),r.mouseData.pointArr.length=0,r.curDrawType){case"pen":r.mouseData.pointArr.push({x:r.mouseData.startX,y:r.mouseData.startY}),t.beginPath();break;case"signpen":r.mouseData.pointArr.push({x:r.mouseData.startX,y:r.mouseData.startY}),t.save(),t.beginPath(),t.globalAlpha=.5,t.globalCompositeOperation="xor",t.strokeStyle=r.conf.sign_pencil.color,t.lineWidth=r.conf.sign_pencil.size*a/800;break;case"rec":r.mouseData.pointArr.push({x:r.mouseData.startX,y:r.mouseData.startY});break;case"rub":var i=r.conf.rub.size;r.mouseData.pointArr.push({x:r.mouseData.startX,y:r.mouseData.startY}),t.clearRect(r.mouseData.startX-i/2,r.mouseData.startY-i/2,i,i);break;case"newrub":var c=r.curTarget;c&&(r.reInitColor(),c.color=r.conf.target.color,r.repaint());break;case"text":var l=e.target||e.srcElement;"input"==l.id?(r.textData.signTextDrag=!0,r.conf.paintBoard.edit.readOnly="true",r.conf.paintBoard.input.style.minWidth=r.conf.paintBoard.input.scrollWidth+"px",r.conf.paintBoard.input.style.minHeight=r.conf.paintBoard.input.scrollHeight+"px",e.preventDefault(),e.stopPropagation()):"edit"==l.id?(r.textData.signTextDrag=!1,r.conf.paintBoard.edit.readOnly="",e.stopPropagation()):"none"==r.conf.paintBoard.input.style.display?null!=r.curTarget&&4==r.curTarget.drawingType?r.reEditText(e):r.write_start(r.mouseData.startX,r.mouseData.startY):(r.write_end(),r.clearConText(),r.textData.signTextDrag=!1);break;case"draft":r.curTarget&&10!=r.curTarget.drawingType&&(r.dragData.initialLeft=r.curTarget.drag_left,r.dragData.initialTop=r.curTarget.drag_top,r.curTarget.color=r.conf.target.color,r.curTarget.display=0,r.repaint(),r.curTarget.display=1,r.curTarget.handle(t,2))}"text"!=r.curDrawType&&(e.preventDefault(),e.stopPropagation())}},mousemove:function(e){e=e||window.event||arguments.callee.caller.arguments[0],r.outEvent=!1;var t=r.conf.canvas.targetBakContext,a=r.conf.canvas.width,n=(r.conf.canvas.height,Math.round(e.clientX+document.body.scrollLeft-r.conf.canvas.left)),s=Math.round(e.clientY+document.body.scrollTop-r.conf.canvas.top);if(r.mouseData.nowX=n,r.mouseData.nowY=s,o.board.mouse.curX=Math.round(e.clientX),o.board.mouse.curY=Math.round(e.clientY),r.downEvent)switch(r.mouseData.minX=n<r.mouseData.minX?n:r.mouseData.minX,r.mouseData.maxX=n>r.mouseData.maxX?n:r.mouseData.maxX,r.mouseData.minY=s<r.mouseData.minY?s:r.mouseData.minY,r.mouseData.maxY=s>r.mouseData.maxY?s:r.mouseData.maxY,r.curDrawType){case"pen":case"signpen":t.lineTo(n,s),t.stroke(),r.mouseData.pointArr.length>450?r.mouseup():r.mouseData.pointArr.push({x:n,y:s});break;case"rec":t.beginPath(),r.clearConText(),t.moveTo(r.mouseData.startX,r.mouseData.startY),t.lineTo(n,r.mouseData.startY),t.lineTo(n,s),t.lineTo(r.mouseData.startX,s),t.lineTo(r.mouseData.startX,r.mouseData.startY),t.lineTo(n,r.mouseData.startY),t.stroke();break;case"rub":var i=r.conf.rub.size;r.mouseData.pointArr.length>450?r.mouseup():(r.mouseData.pointArr.push({x:n,y:s}),r.conf.canvas.targetContext.clearRect(n-i/2,s-i/2,i,i));break;case"newrub":r.curTarget=r.e_search(n,s);var c=r.curTarget;c?(r.reInitColor(),c.color=r.conf.target.color,r.repaint()):(r.reInitColor(),r.repaint());break;case"text":r.textData.signTextDrag&&(r.conf.paintBoard.input.style.left=r.textData.pointXTD+n-r.mouseData.startX+"px",r.conf.paintBoard.input.style.top=r.textData.pointYTD+s-r.mouseData.startY+"px",r.textData.pointLeftTD=r.textData.pointXTD+n-r.mouseData.startX,r.textData.pointTopTD=r.textData.pointYTD+s-r.mouseData.startY);break;case"draft":if(r.curTarget){r.clearConText();var l=r.curTarget.canvasWidth/a;r.curTarget.drag_left=Math.round((n-r.mouseData.startX)*l+r.dragData.initialLeft),r.curTarget.drag_top=Math.round((s-r.mouseData.startY)*l+r.dragData.initialTop),r.curTarget.handle(t,2)}}else if(!r.conf.pauseDraw&&"new"==r.conf.version&&!r.textData.signREdit)if(r.curTarget=null,r.curTarget=r.e_search(n,s),r.curTarget){var d="newrub"==r.curDrawType,u="draft"==r.curDrawType&&10!=r.curTarget.drawingType,p="text"==r.curDrawType&&4==r.curTarget.drawingType,f=r.curTarget.id!=r.colorChangeId;(d||u||p)&&f&&(r.reInitColor(),r.colorChange=!0,4!=r.curTarget.drawingType?r.curTarget.color=r.conf.target.color:r.curTarget.font_color=r.conf.target.color,r.repaint(),r.colorChangeId=r.curTarget.id)}else r.colorChange&&(r.reInitColor(),r.repaint(),r.colorChange=!1,r.colorChangeId=-1);"text"!=r.curDrawType&&(e.preventDefault(),e.stopPropagation())},mouseup:function(e){if(e=e||window.event||arguments.callee.caller.arguments[0],!r.conf.pauseDraw&&r.downEvent){var t,a=r.conf.canvas.width,o=r.conf.canvas.height;"text"==r.curDrawType&&(t=r.inputRange(),r.conf.paintBoard.edit.focus()),r.downEvent=!1;var s=0,i=0;if(s=e.clientX?Math.round(e.clientX+document.body.scrollLeft-r.conf.canvas.left):r.mouseData.nowX,i=e.clientY?Math.round(e.clientY+document.body.scrollTop-r.conf.canvas.top):r.mouseData.nowY,"rec"===r.curDrawType){var c=Math.round(r.conf.pencil.size*a/800);s=s-c>=0?s:c,i=i-c>=0?i:c,s=s+c-r.conf.canvas.width<=0?s:r.conf.canvas.width-c,i=i+c-r.conf.canvas.height<=0?i:r.conf.canvas.height-c}r.mouseData.minX=s<r.mouseData.minX?s:r.mouseData.minX,r.mouseData.maxX=s>r.mouseData.maxX?s:r.mouseData.maxX,r.mouseData.minY=i<r.mouseData.minY?i:r.mouseData.minY,r.mouseData.maxY=i>r.mouseData.maxY?i:r.mouseData.maxY;var l=Math.max(Math.round(r.mouseData.maxX-r.mouseData.minX),Math.round(10*a/800)),d=Math.max(Math.round(r.mouseData.maxY-r.mouseData.minY),Math.round(10*a/800));r.mouseData.pointArr.push({x:s,y:i});var u=r.mouseData.minX!=r.mouseData.maxX||r.mouseData.minY!=r.mouseData.maxY;switch(r.curDrawType){case"pen":if(u){var p={handleType:0,drawingType:0,id:r.svcId,specialValue:{owner:r.conf.type,pencil_color:r.conf.pencil.color,pencil_size:r.conf.pencil.size,canvasWidth:a,canvasHeight:o,child_div_W:l,child_div_H:d,margin_left:Math.round(r.mouseData.minX),margin_top:Math.round(r.mouseData.minY),point:r.mouseData.pointArr.slice(0)}};r.showPaint(p),n.sendCommData("paint",JSON.stringify(p)),r.clearConText()}break;case"signpen":if(u){var p={handleType:0,drawingType:10,id:r.svcId,specialValue:{owner:r.conf.type,pencil_color:r.conf.sign_pencil.color,pencil_size:r.conf.sign_pencil.size,canvasWidth:a,canvasHeight:o,child_div_W:l,child_div_H:d,margin_left:Math.round(r.mouseData.minX),margin_top:Math.round(r.mouseData.minY),point:r.mouseData.pointArr.slice(0)}};r.showPaint(p),n.sendCommData("paint",JSON.stringify(p)),r.conf.canvas.targetBakContext.restore(),r.clearConText()}break;case"rec":if(u){l=r.mouseData.maxX-r.mouseData.minX,d=r.mouseData.maxY-r.mouseData.minY;var p={handleType:0,drawingType:2,id:r.svcId,specialValue:{owner:r.conf.type,pencil_color:r.conf.pencil.color,pencil_size:r.conf.pencil.size,canvasWidth:a,canvasHeight:o,child_div_W:l,child_div_H:d,margin_left:Math.round(r.mouseData.minX),margin_top:Math.round(r.mouseData.minY),point:r.mouseData.pointArr.slice(0)}};r.showPaint(p),n.sendCommData("paint",JSON.stringify(p)),r.clearConText()}break;case"rub":var p={handleType:0,drawingType:3,id:r.svcId,specialValue:{owner:r.conf.type,pencil_color:r.conf.pencil.color,pencil_size:r.conf.pencil.size,canvasWidth:a,canvasHeight:o,child_div_W:l,child_div_H:d,margin_left:Math.round(r.mouseData.minX),margin_top:Math.round(r.mouseData.minY),point:r.mouseData.pointArr.slice(0)}},f=r.conf.rub.size;r.conf.canvas.targetContext.clearRect(s-f/2,i-f/2,f,f),r.showPaint(p),n.sendCommData("paint",JSON.stringify(p)),console.log("发送橡皮擦数据:",JSON.stringify(p));break;case"newrub":var g=r.e_search(s,i);if(g){var p={handleType:0,drawingType:500,id:r.svcId,specialValue:{id:g.id,type:0}};4==g.drawingType?g.color=r.conf.font.fontColor:10==g.drawingType?g.color=r.conf.target.color:g.color=r.conf.pencil.color,r.showPaint(p),r.repaint(),n.sendCommData("paint",JSON.stringify(p))}else r.reInitColor(),r.repaint();break;case"text":if(r.textData.signTextDrag){var h=r.conf.paintBoard.input,m=r.conf.paintBoard.edit,w=r.conf.paintBoard.inputBakContain,v=2*r.textData.inputBorder,y=Math.round(r.conf.font.fontSize*a/800);r.textData.pointLeftTD=r.textData.pointXTD+s-r.mouseData.startX,r.textData.pointTopTD=r.textData.pointYTD+i-r.mouseData.startY,r.textData.pointXTD=r.textData.pointLeftTD+t.shiftX,r.textData.pointYTD=r.textData.pointTopTD+t.shiftY,r.textData.inputMaxWid=a-r.textData.pointXTD-v,r.textData.inputMaxHei=o-r.textData.pointYTD-v,h.style.maxWidth=r.textData.inputMaxWid+"px",h.style.maxHeight=r.textData.inputMaxHei+"px",w.style.maxWidth=r.textData.inputMaxWid+"px",w.style.maxHeight=r.textData.inputMaxHei+"px",h.style.left=r.textData.pointXTD+"px",h.style.top=r.textData.pointYTD+"px",h.style.minWidth=y+"px",h.style.minHeight=y+"px",r.textData.signTextDrag=!1,m.readOnly=""}break;case"draft":if(u){if((s-r.mouseData.startX!=0||i-r.mouseData.startY!=0)&&r.curTarget&&!r.textData.signREdit){var _=a/r.curTarget.canvasWidth;_*(r.curTarget.margin_left+r.curTarget.drag_left)<0&&(r.curTarget.drag_left=Math.round(0-r.curTarget.margin_left)),_*(r.curTarget.margin_top+r.curTarget.drag_top)<0&&(r.curTarget.drag_top=Math.round(0-r.curTarget.margin_top)),_*(r.curTarget.margin_left+r.curTarget.drag_left+r.curTarget.child_div_W)>a&&(r.curTarget.drag_left=Math.round((a-10)/_-r.curTarget.child_div_W-r.curTarget.margin_left)),_*(r.curTarget.margin_top+r.curTarget.drag_top+r.curTarget.child_div_H)>o&&(r.curTarget.drag_top=Math.round(o/_-r.curTarget.child_div_H-r.curTarget.margin_top)),r.clearConText();var p={handleType:0,drawingType:500,id:r.svcId,specialValue:{id:r.curTarget.id,type:1,drag_left:Math.round(r.curTarget.drag_left),drag_top:Math.round(r.curTarget.drag_top)}};r.showPaint(p),r.curTarget.handle(r.conf.canvas.targetContext,2),n.sendCommData("paint",JSON.stringify(p))}}else r.repaint()}try{"text"!=r.curDrawType&&(r.clearConText(),e.preventDefault(),e.stopPropagation())}catch(e){}}r.outEvent=!1},mouseout:function(e){var t=e.target||e.srcElement;r.outEvent=!0,r.downEvent&&"input"!=t.id&&"edit"!=t.id&&"text"!=r.curDrawType&&r.mouseup(),e.preventDefault(),e.stopPropagation()},key_event:function(e,t){r.textData.signTextDrag&&r.mouseup(),e.innerText=e.innerText.toString(),r.textData.textInput=e.innerText,r.conf.paintBoard.inputBak.innerText="",r.conf.paintBoard.inputBak.innerText=r.textData.textInput,r.conf.paintBoard.inputBakContain.scrollHeight!=r.conf.paintBoard.inputBakContain.clientHeight&&8!=t.keyCode&&46!=t.keyCode?(e.innerText=r.textData.lastTextInput,r.keyAction(e),t.preventDefault()):(r.textData.lastTextInput=r.textData.textInput,r.textData.textInput="");var a=parseInt(document.getElementById("paintBoard").style.top.replace("px",""))+parseInt(r.conf.paintBoard.input.style.top.replace("px",""))+parseInt(r.conf.paintBoard.input.scrollHeight),o=parseInt(document.getElementById("overview").style.top.replace("px","")),n=parseInt(document.getElementById("workSpace").style.height.replace("px",""));a+o-n>0&&(document.getElementById("overview").style.top=n-a-2*r.textData.inputBorder+"px",$("#scrollbar1").tinyscrollbar_update(a-n)),r.keyAction(e),r.conf.paintBoard.inputBak.innerText=""},write_start:function(e,t){var a=r.conf.paintBoard.input,o=r.conf.paintBoard.edit,n=r.conf.paintBoard.inputBak,s=r.conf.paintBoard.inputBakContain,i=r.conf.canvas.width,c=r.conf.canvas.height;o.autofocus="true",o.innerText="",r.textData.textInput="";var l=Math.round(r.conf.font.fontSize*i/800),d=Math.round((r.conf.font.fontSize+10)*i/800),u=Math.round(4*i/800);t=t+d+2*u>c?c-d-2*u:t,e=e+l+2*u>i?i-l-2*u:e,r.textData.inputBorder=u,r.textData.inputMaxWid=i-e-2*u,r.textData.inputMaxHei=c-t-2*u,r.textData.fontSize=Math.round(r.conf.font.fontSize*i/800),a.style.border="dashed "+r.textData.inputBorder+"px blue",a.style.zIndex=5,a.style.maxWidth=r.textData.inputMaxWid+"px",a.style.maxHeight=r.textData.inputMaxHei+"px",a.style.display="block",a.style.left=e+"px",a.style.top=t+"px",o.style.minWidth=l+"px",o.style.display="block",o.style.font="bold "+r.textData.fontSize+"px "+r.conf.font.fontStyle,s.style.border="dashed "+r.textData.inputBorder+"px blue",s.style.maxWidth=r.textData.inputMaxWid+"px",s.style.maxHeight=r.textData.inputMaxHei+"px",n.style.font="bold "+r.textData.fontSize+"px "+r.conf.font.fontStyle,r.textData.pointXTD=e,r.textData.pointYTD=t,r.textData.pointLeftTD=e,r.textData.pointTopTD=t},write_writing:function(){"none"!=r.conf.paintBoard.input.style.display&&r.write_end()},write_end:function(){var e=r.conf.canvas.width,t=r.conf.canvas.height,a=parseInt(r.conf.paintBoard.input.scrollWidth),o=parseInt(r.conf.paintBoard.input.scrollHeight);r.conf.paintBoard.input.style.display="none",r.conf.paintBoard.edit.style.display="none";var s="",i="",c="",l=-1,d=-1,u=-1,p=0,f=0;if(s=r.conf.paintBoard.edit.innerHTML,s=r.removeDanger(s),f=s.length,-1!=s.indexOf("<div>")||-1!=s.indexOf("<br>")){for(p=0;p<f;p++){if(l=s.indexOf("<div>"),d=s.indexOf("<br>"),u=s.indexOf("</div>"),-1==l){if(-1==d){s=s.replace(/<\/div>/g,"");break}s=s.replace(/<br>/g,"\n");break}if(-1==d){s.replace(/<div>/g,"\n").replace(/<\/div>/g,"");break}d<l?s=s.replace(/<br>/,"\n"):d<u?s.replace(/<div>/,"\n").replace(/<\/div>/,"").replace(/<br>/,""):s.replace(/<div>/,"\n").replace(/<\/div>/,"")}s=-1!=s.indexOf("<div>")?s.replace(/<div>/g,"\n").replace(/<\/div>/g,"").replace(/<br>/g,""):s.replace(/<br>/g,"\n")}if(""!=s){var g="",h=0,m=0,w=r.conf.paintBoard.inputBakContain;r.conf.paintBoard.inputBak.innerText="";for(var v=0;v<s.length;v++,h++)"\n"!=s.charAt(v)&&"\r\n"!=s.charAt(v)?(r.conf.paintBoard.inputBak.innerText+=s.charAt(v),0!=m&&w.clientHeight>m&&Math.abs(w.clientHeight-m)>r.conf.font.fontSize/3?(g+="\n",i+=g,g=s.charAt(v)):g+=s.charAt(v),v+1==s.length&&(i+=g),m=w.clientHeight):(g+="\n",i+=g,g="",r.conf.paintBoard.inputBak.innerText="",m=w.clientHeight);r.conf.paintBoard.inputBak.innerText="",c=i}if(r.textData.signREdit){var y=r.curTarget.canvasWidth/e;r.curTarget.child_div_W=Math.round(a*y),r.curTarget.child_div_H=Math.round(o*y),r.curTarget.drag_left=Math.round(r.textData.pointXTD*y-r.curTarget.margin_left),r.curTarget.drag_top=Math.round(r.textData.pointYTD*y-r.curTarget.margin_top);var _={handleType:0,drawingType:500,id:r.svcId,specialValue:{id:r.curTarget.id,type:2,font:{font_color:r.conf.pencil.color,font_size:Math.round(r.conf.font.fontSize*y),font_style:r.conf.font.fontStyle},child_div_W:Math.round(r.curTarget.child_div_W),child_div_H:Math.round(r.curTarget.child_div_H),drag_left:Math.round(r.curTarget.drag_left),drag_top:Math.round(r.curTarget.drag_top),str_text:window.MyBase64.encode(c)}};n.sendCommData("paint",JSON.stringify(_)),r.curTarget.display=1,r.showPaint(_),r.textData.signREdit=!1}else if(""!=s){var _={handleType:0,drawingType:4,id:r.svcId,specialValue:{owner:r.conf.type,font:{font_color:r.conf.pencil.color,font_size:Math.round(r.conf.font.fontSize*e/800),font_style:r.conf.font.fontStyle},canvasWidth:e,canvasHeight:t,child_div_W:Math.round(a),child_div_H:Math.round(o),margin_left:Math.round(r.textData.pointXTD),margin_top:Math.round(r.textData.pointYTD),str_text:window.MyBase64.encode(c)}};n.sendCommData("paint",JSON.stringify(_)),r.showPaint(_)}r.downEvent=!1,r.conf.paintBoard.edit.innerText=""},inputRange:function(){var e=r.conf.paintBoard.input,t=r.conf.canvas.width,a=r.conf.canvas.height,o=parseInt(e.scrollWidth),n=parseInt(e.scrollHeight),s=parseInt(e.style.left.replace("px","")),i=parseInt(e.style.top.replace("px","")),c=0,l=0,d=2*r.textData.inputBorder;return s+o+d>=t&&(c=t-s-o-d),i+n+d>=a&&(l=a-i-n-d),s<0&&(c=0-s),i<0&&(l=0-i),{shiftX:c,shiftY:l}},removeDanger:function(e){var t=e;return t=t.replace(/&nbsp;/g," "),t=t.replace(/&amp;/g,"&"),t=t.replace(/&quot;/g,"\\"),t=t.replace(/&#039;/g,"'"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">")},keyAction:function(e){var t=e,a=window.getSelection(),o=document.createRange();o.selectNodeContents(t),o.collapse(!1),a.removeAllRanges(),a.addRange(o)},objFactory:function(e,t,a,o){return{handleType:e,drawingType:t,id:a,specialValue:o}},reEditText:function(e){e=e||window.event||arguments.callee.caller.arguments[0];var t=r.conf.paintBoard.input,a=r.conf.paintBoard.edit,o=r.conf.paintBoard.inputBak,n=r.conf.paintBoard.inputBakContain,s=r.conf.canvas.width,i=r.conf.canvas.height;if(r.curTarget&&0==r.curTarget.handleType&&4==r.curTarget.drawingType){r.textData.signREdit=!0,r.curTarget.display=0,r.repaint();var c=r.curTarget.point_Arr_text,l=r.conf.canvas.width/r.curTarget.canvasWidth,d=Math.round(4*s/800);r.textData.inputBorder=d,r.textData.inputMaxWid=s-(r.curTarget.drag_left+r.curTarget.margin_left)*l-2*d,r.textData.inputMaxHei=i-(r.curTarget.drag_top+r.curTarget.margin_top)*l-2*d,r.textData.fontSize=Math.round(r.curTarget.font_size*l),t.style.border="dashed "+r.textData.inputBorder+"px red",t.style.zIndex=5,t.style.display="block",t.style.maxWidth=r.textData.inputMaxWid+"px",t.style.maxHeight=r.textData.inputMaxHei+"px",t.style.left=(r.curTarget.margin_left+r.curTarget.drag_left)*l+"px",t.style.top=(r.curTarget.margin_top+r.curTarget.drag_top)*l+"px",a.style.display="block",a.style.font="bold "+r.textData.fontSize+"px "+r.conf.font.fontStyle,o.style.font="bold "+r.textData.fontSize+"px "+r.conf.font.fontStyle,n.style.border="dashed "+r.textData.inputBorder+"px red",n.style.maxWidth=r.textData.inputMaxWid+"px",n.style.maxHeight=r.textData.inputMaxHei+"px",r.conf.paintBoard.edit.innerText=c,r.keyAction(r.conf.paintBoard.edit),r.textData.pointXTD=(r.curTarget.margin_left+r.curTarget.drag_left)*l,r.textData.pointYTD=(r.curTarget.margin_top+r.curTarget.drag_top)*l,r.textData.pointLeftTD=r.textData.pointXTD,r.textData.pointTopTD=r.textData.pointYTD}},reInitColor:function(){for(var e=r.recordConArr,t=0,a=e.length;t<a;t++)10!=e[t].drawingType?4!=e[t].drawingType?e[t].color="tea"==e[t].login_type?r.conf.canvas.teaPenC:r.conf.canvas.stuPenC:e[t].font_color="tea"==e[t].login_type?r.conf.canvas.teaFontC:r.conf.canvas.stuFonC:e[t].color="tea"==e[t].login_type?r.conf.canvas.teaSignPen:r.conf.canvas.stuSignPen},e_search:function(e,t){var a,o,n,s,i=r.getOffset(r.conf.paintBoard.PaintBoard);for(r.conf.canvas.left=i.left,r.conf.canvas.top=i.top,n=0,s=r.recordConArr.length;n<s;n++)if(a=r.recordConArr[n],o=r.conf.canvas.width/a.canvasWidth,0==a.handleType&&500!=a.drawingType&&3!=a.drawingType&&1==a.display&&(10!=a.drawingType||"draft"!=r.curDrawType)&&e>=(a.margin_left+a.drag_left)*o&&t>=(a.margin_top+a.drag_top)*o&&e<=(a.margin_left+a.child_div_W+a.drag_left)*o&&t<=(a.margin_top+a.child_div_H+a.drag_top)*o)return a;return null},showPaint:function(e){try{if(0==e.handleType)if(-1!=[0,2,3,4,10,500].indexOf(e.drawingType))if(500!=e.drawingType){var t=new s(e);t.init_paint(e),3==e.drawingType&&console.log("接收橡皮擦数据:",JSON.stringify(e)),t.handle(r.conf.canvas.targetContext)}else switch(e.specialValue.type){case 0:var a=r.searchByID(e.specialValue.id);null!=a?(a.init_paint(e),r.repaint()):console.error("[%s] -----------\x3e error happened when new rubber: error id to new rubber",window.getTimeNow());break;case 1:var a=r.searchByID(e.specialValue.id);null!=a?(a.init_paint(e),r.repaint()):console.error("[%s] -----------\x3e error happened when draft handle: error id to draft",window.getTimeNow());break;case 2:var a=r.searchByID(e.specialValue.id);null!=a?(a.init_paint(e),r.repaint()):console.error("[%s] -----------\x3e error happened when reedit handle: error id to reedit",window.getTimeNow());break;default:o.update.tip_update&&(r.orderList.push(-2),r.svcId++,$("#update_cue").css("display","block"),console.error("[%s] -----------\x3e get unknown specialValue.type for 500 : type is %d",window.getTimeNow(),e.specialValue.type))}else o.update.tip_update&&(r.orderList.push(-3),r.svcId++,$("#update_cue").css("display","block"),console.error("[%s] -----------\x3e get unknown drawingType handleType 0: drawingType is %d",window.getTimeNow(),e.drawingType));else 1==e.handleType?1==e.drawingType?r.draw("back",1):2==e.drawingType?r.draw("clear",1):o.update.tip_update&&($("#update_cue").css("display","block"),console.error("[%s] -----------\x3e get unknown drawingType of handleType 1: drawingType is %d",window.getTimeNow(),e.drawingType)):2==e.handleType?o.update.tip_update&&($("#update_cue").css("display","block"),console.error("[%s] -----------\x3e get unknown drawingType of handleType 2: drawingType is %d",window.getTimeNow(),e.drawingType)):o.update.tip_update&&($("#update_cue").css("display","block"),console.error("[%s] -----------\x3e get unknown handleType: handleType is %d",window.getTimeNow(),e.handleType))}catch(a){console.error("[%s] -----------\x3e error happened when Paint update: %s",window.getTimeNow(),a)}},searchByID:function(e){var t,a,o=r.recordConArr;for(t=0,a=o.length;t<a;t++)if(o[t].id==e&&0!=o[t].changeCount)return o[t];return null},handle_back:function(e){var t,a;for(t=0,a=r.recordConArr.length;t<a;t++)if(r.recordConArr[t].id==e&&0!=r.recordConArr[t].changeCount){r.clearConText(1);var o=r.recordConArr[t];if(0==--o.changeCount)o.display=0,r.svcId--;else{var n=o.Arr_data_handle.pop();if(500==n.drawingType&&0==n.specialValue.type)o.display=1;else{var s=o.Arr_data_handle[o.Arr_data_handle.length-1];o.init_paint(s,1)}}r.repaint()}},handle_clear:function(){for(var e,t=0,a=r.recordConArr.length;t<a;t++)e=r.recordConArr[t],e.display=0,e.changeCount=0;r.orderList.length=0,r.repaint(),r.svcId=1},clearConText:function(e){try{e?(r.conf.canvas.targetContext.clearRect(0,0,r.conf.canvas.width,r.conf.canvas.height),r.conf.canvas.targetBakContext.clearRect(0,0,r.conf.canvas.width,r.conf.canvas.height)):r.conf.canvas.targetBakContext.clearRect(0,0,r.conf.canvas.width,r.conf.canvas.height)}catch(e){}},repaint:function(){r.clearConText(1);for(var e,t=0,a=r.recordConArr.length;t<a;)e=r.recordConArr[t],e.handle(r.conf.canvas.targetContext,2),t++},getOffset:function(e,t){return t||(t={},t.top=0,t.left=0),e==document.body?t:(t.top+=e.offsetTop,t.left+=e.offsetLeft,r.getOffset(e.parentNode,t))}},s=function(e){this.Arr_data_handle=new Array,void 0!=e.specialValue.owner?this.login_type=e.specialValue.owner:4==e.drawingType?this.login_type=e.specialValue.font.font_color==r.conf.canvas.teaFontC?"tea":"stu":this.login_type=e.specialValue.pencil_color==r.conf.canvas.teaPenC?"tea":"stu",this.version_type=r.conf.version,this.id=r.svcId,this.handleType=e.handleType,this.drawingType=e.drawingType,r.orderList.push(r.svcId),r.recordConArr.push(this),r.svcId++};s.prototype.init_paint=function(e,t){if(t||this.Arr_data_handle.push(e),0==e.handleType)if(500!=e.drawingType)this.canvasWidth=e.specialValue.canvasWidth,this.canvasHeight=e.specialValue.canvasHeight,this.changeCount=1,this.display=1,this.child_div_W=e.specialValue.child_div_W,this.child_div_H=e.specialValue.child_div_H,this.margin_left=e.specialValue.margin_left,this.margin_top=e.specialValue.margin_top,this.drag_left=0,this.drag_top=0,4==e.drawingType?(this.font_color=e.specialValue.font.font_color,this.font_size=e.specialValue.font.font_size,this.font_style=e.specialValue.font.font_style,this.point_Arr_text=window.MyBase64.decode(e.specialValue.str_text).replace(/\/u0027/g,"'")):(this.color=e.specialValue.pencil_color,this.size=e.specialValue.pencil_size,this.point_Arr_text=e.specialValue.point);else switch(r.orderList.push(this.id),r.svcId++,t||this.changeCount++,e.specialValue.type){case 0:this.display=0;break;case 1:this.drag_left=e.specialValue.drag_left,this.drag_top=e.specialValue.drag_top;break;case 2:this.child_div_W=e.specialValue.child_div_W,this.child_div_H=e.specialValue.child_div_H,this.drag_left=e.specialValue.drag_left,this.drag_top=e.specialValue.drag_top,this.point_Arr_text=window.MyBase64.decode(e.specialValue.str_text).replace(/\/u0027/g,"'")}else 1==e.handleType||e.handleType},s.prototype.handle=function(e){try{if(1==this.display&&o.classInfo.textInfo.curPage==o.classInfo.serverInfo.curPage)switch(this.drawingType){case 0:this.canvas_pencil(e);break;case 2:this.canvas_square(e);break;case 10:this.canvas_sign(e);break;case 4:this.canvas_write(e);break;case 3:this.canvas_rubber(e)}}catch(e){console.error("[%s] -----------\x3e error happened when paint.prototype.handle : %s",window.getTimeNow(),e)}},s.prototype.canvas_pencil=function(e){var t=r.conf.canvas.width/this.canvasWidth,a=r.conf.canvas.width/800,o=Math.round(r.conf.pencil.size*a);e.lineCap="round",e.lineJoin="round",e.strokeStyle=this.color,e.lineWidth=o,e.moveTo((this.point_Arr_text[0].x+this.drag_left)*t,(this.point_Arr_text[0].y+this.drag_top)*t),e.beginPath();for(var n=1;n<this.point_Arr_text.length;n++)e.lineTo((this.point_Arr_text[n].x+this.drag_left)*t,(this.point_Arr_text[n].y+this.drag_top)*t);e.stroke()},s.prototype.canvas_square=function(e){var t=r.conf.canvas.width/this.canvasWidth,a=r.conf.canvas.width/800,o=Math.round(r.conf.pencil.size*a);e.strokeStyle=this.color,e.lineJoin="round",e.lineWidth=o,e.moveTo((this.point_Arr_text[0].x+this.drag_left)*t,(this.point_Arr_text[0].y+this.drag_top)*t),e.beginPath(),e.lineTo((this.point_Arr_text[1].x+this.drag_left)*t,(this.point_Arr_text[0].y+this.drag_top)*t),e.lineTo((this.point_Arr_text[1].x+this.drag_left)*t,(this.point_Arr_text[1].y+this.drag_top)*t),e.lineTo((this.point_Arr_text[0].x+this.drag_left)*t,(this.point_Arr_text[1].y+this.drag_top)*t),e.lineTo((this.point_Arr_text[0].x+this.drag_left)*t,(this.point_Arr_text[0].y+this.drag_top)*t),e.closePath(),e.stroke()},s.prototype.canvas_sign=function(e){e.save();var t=r.conf.canvas.width/this.canvasWidth;e.lineCap="round",e.lineJoin="round",e.strokeStyle=this.color,e.globalAlpha=.3,e.globalCompositeOperation="destination-over",e.lineWidth=this.size*r.conf.canvas.width/800,e.moveTo((this.point_Arr_text[0].x+this.drag_left)*t,(this.point_Arr_text[0].y+this.drag_top)*t),e.beginPath();for(var a=2;a<this.point_Arr_text.length;a++)e.lineTo((this.point_Arr_text[a].x+this.drag_left)*t,(this.point_Arr_text[a].y+this.drag_top)*t);e.stroke(),e.restore()},s.prototype.canvas_write=function(e){var t,a,o=this.point_Arr_text,n=r.conf.canvas.width/this.canvasWidth,s=(this.margin_top+this.drag_top)*n,i=(this.margin_left+this.drag_left)*n+r.textData.inputBorder,c=[];for(e.font="bold "+Math.round(this.font_size*n)+"px "+r.conf.font.fontStyle,e.fillStyle=this.font_color,o.replace(/\r\n/g,"\n"),c=o.split(/\n/),t=0,a=c.length;t<a;t++)s+=this.font_size*n,e.fillText(c.shift(),i,s)},s.prototype.canvas_rubber=function(e){e.save();var t=r.conf.canvas.width/this.canvasWidth,a=r.conf.rub.size*t;e.lineCap="round",e.lineJoin="round",e.lineWidth=a,e.globalCompositeOperation="destination-out",e.moveTo((this.point_Arr_text[0].x+this.drag_left)*t,(this.point_Arr_text[0].y+this.drag_top)*t),e.beginPath();for(var o=1;o<this.point_Arr_text.length;o++)e.lineTo((this.point_Arr_text[o].x+this.drag_left)*t,(this.point_Arr_text[o].y+this.drag_top)*t);e.stroke(),e.restore()},t.resizePaint=function(e,t,a,o){r.review(e,t,a,o)},t.draw=function(e){r.draw(e)},t.showCefPaint=function(e){r.showPaint(e)},t.setBoardConf=function(e){r.conf.type=void 0!=e.type?e.type:r.conf.type,r.conf.version=void 0!=e.version?e.version:r.conf.version,void 0!=e.pauseDraw&&(e.pauseDraw&&(r.conf.paintBoard.input&&"none"!=r.conf.paintBoard.input.style.display?r.write_end():r.mouseup()),r.conf.pauseDraw=e.pauseDraw),
void 0!=e.paintModule&&(r.conf.paintModule=void 0!=e.paintModule?e.paintModule:r.conf.paintModule,"draw"===r.conf.paintModule&&!1===r.binded&&r.initWEBTools()),void 0!=e.pencil&&(r.conf.pencil.color=void 0!=e.pencil.color?e.pencil.color:r.conf.pencil.color,r.conf.pencil.size=void 0!=e.pencil.size?e.pencil.size:r.conf.pencil.size),void 0!=e.sign_pencil&&(r.conf.sign_pencil.color=void 0!=e.sign_pencil.color?e.sign_pencil.color:r.conf.sign_pencil.color,r.conf.sign_pencil.size=void 0!=e.sign_pencil.size?e.sign_pencil.size:r.conf.sign_pencil.size),void 0!=e.rub&&(r.conf.rub.size=void 0!=e.rub.size?e.rub.size:r.conf.rub.size),void 0!=e.font&&(r.conf.font.fontStyle=void 0!=e.font.fontStyle?e.font.fontStyle:r.conf.font.fontStyle,r.conf.font.fontSize=void 0!=e.font.fontSize?e.font.fontSize:r.conf.font.fontSize,r.conf.font.fontColor=void 0!=e.font.fontColor?e.font.fontColor:r.conf.font.fontColor),e.target&&(r.conf.font.fontStyle=void 0!=e.font.fontStyle?e.font.fontStyle:r.conf.font.fontStyle)},t.rePaint=function(){r.repaint()},t.clearPaint=function(){r.clearConText(1)}}),define("eventBind",["boardConf","enDataSend","moduleTools"],function(e,t,a){var o=e("boardConf").conf,n=e("enDataSend"),r=e("moduleTools"),s={Arr_scroll:[],mouse:{lastX:0,lastY:0},topScroll:0,bind:function(){var e=document.getElementById("showDomain");e.attachEvent?e.attachEvent("onload",function(){s.loadedEvent()}):e.onload=function(){s.loadedEvent()},window.addEventListener("resize",function(){console.log("[%s] -----------\x3e listen resize event",window.getTimeNow()),s.throttleStep(s.resizeEvent)}),o.event.scrollData&&(console.log("[%s] -----------\x3e listen scroll data event",window.getTimeNow()),this.scrollDataEvent()),o.event.fixedData&&(console.log("[%s] -----------\x3e listen fixed data event",window.getTimeNow()),this.fixedDataEvent()),o.moduleSet.page&&(console.log("[%s] -----------\x3e listen page handle event",window.getTimeNow()),this.pageChangeEvent()),o.moduleSet.tools&&(console.log("[%s] -----------\x3e listen tools handle event",window.getTimeNow()),this.toolChangeEvent()),o.moduleSet.update&&(console.log("[%s] -----------\x3e listen update event (unknow type from svc)",window.getTimeNow()),$("#update_cue").bind("click",function(e){"cue_close"==e.target.id?$("#update_cue").css("visibility","hidden"):"cue_stop"==e.target.id?(o.update.tip_update=!1,$("#update_cue").css("visibility","hidden")):"cue_update"==e.target.id&&$("#update_cue").css("visibility","hidden")})),(o.event.mouse||o.event.barScroll||o.event.timeTip)&&(setInterval(function(){o.event.mouse&&s.mouseEvent(),o.event.barScroll&&s.barScrollEvent(),o.event.timeTip&&s.timeTipEvent(),o.board.mouse.mouseSign<o.board.mouse.mouseMax&&++o.board.mouse.mouseSign>=o.board.mouse.mouseMax&&$("#mouseTea").hide()},1e3),o.event.mouse&&console.log("[%s] -----------\x3e listen mouse event",window.getTimeNow()),o.event.barScroll&&console.log("[%s] -----------\x3e listen scroll event",window.getTimeNow()),o.event.timeTip&&console.log("[ %s ]-----------\x3e listen tools handle event",window.getTimeNow())),o.moduleSet.ccLayer&&this.ccLayer(),s.throttleStep(s.resizeEvent)},loadedEvent:function(){var e=!0;if("h5Course"===o.host.textType&&(window.iFrameParIO.parentCon=$(window.parent.document).contents().find("#showDomain")[0].contentWindow,e=window.iFrameParIO.H5Course.init(),window.iFrameParIO.dataDrawI(0,0,0,0)),e){if("tea"===o.user.type&&o.classInfo.serverInfo.curPage!==o[o.host.textType].curPage)return void r.agentTools("gopage",{targetPage:o[o.host.textType].curPage});o.classInfo.textInfo.curPage=o.classInfo.serverInfo.curPage;var t={cur:o.classInfo.textInfo.curPage-1,count:o.classInfo.textInfo.countPage};n.sendCommData("teenpage",JSON.stringify(t)),window.iFrameParIO.setPageO(o.classInfo.serverInfo.curPage)}},fixedDataEvent:function(){$("#data_close").bind("click",function(e){var t={type:"fixdata",status:"close"};n.sendCommData("tipdata",JSON.stringify(t)),$(".fixdata_tea").css("display","none"),e.preventDefault(),e.stopPropagation()})},scrollDataEvent:function(){$(".scroll_tea").css("display","block"),"teen"==o.user.type?(this.Arr_scroll.push("Speak slowly."),this.Arr_scroll.push("Ask students to repeat new words and sentences 2 times."),this.Arr_scroll.push("Use more TPR and gestures."),this.Arr_scroll.push("Motivate the student to speak complete sentences."),this.Arr_scroll.push("Keep instructions simple and short.")):(this.Arr_scroll.push("Speak slowly to low-leveled students."),this.Arr_scroll.push("Motivate students to speak complete sentences."),this.Arr_scroll.push("Ask students to repeat new words and sentences 2 times."),this.Arr_scroll.push("Correct only those mistakes that lead to misunderstanding."),this.Arr_scroll.push("Don’t stay at warm-up too long, and there must be a wrap-up")),$(".scroll_tea").text(s.Arr_scroll.shift()),setTimeout(function(){setInterval(function(){0==s.Arr_scroll.length?("teen"==o.user.type?(s.Arr_scroll.push("Speak slowly."),s.Arr_scroll.push("Ask students to repeat new words and sentences 2 times."),s.Arr_scroll.push("Use more TPR and gestures."),s.Arr_scroll.push("Motivate the student to speak complete sentences."),s.Arr_scroll.push("Keep instructions simple and short.")):(s.Arr_scroll.push("Speak slowly to low-leveled students."),s.Arr_scroll.push("Motivate students to speak complete sentences."),s.Arr_scroll.push("Ask students to repeat new words and sentences 2 times."),s.Arr_scroll.push("Correct only those mistakes that lead to misunderstanding."),s.Arr_scroll.push("Don’t stay at warm-up too long, and there must be a wrap-up")),$(".scroll_tea").text(s.Arr_scroll.shift())):$(".scroll_tea").text(s.Arr_scroll.shift())},5e3)},5e3)},mouseEvent:function(){var e=o.board.mouse,t=o.classInfo,a=s.getOffset(document.getElementById("paintBoard"));if(s.mouse.lastX!=e.curX||s.mouse.lastY!=e.curY){var r={canvasWidth:t.drawInfo.width,canvasHeight:t.drawInfo.height,mouseX:e.curX-a.left,mouseY:e.curY-a.top,CurrentPage:t.textInfo.curPage};n.sendCommData("mouse",JSON.stringify(r)),s.mouse.lastX=e.curX,s.mouse.lastY=e.curY}},pageChangeEvent:function(){$("#toolbar_id").find(".toolbarRight, .toolbarRight_m").bind("click",function(e){e=e||window.event||arguments.callee.caller.arguments[0];var t=e.target.id,a=null;switch(t){case"previousPage":o.classInfo.textInfo.curPage-1>0&&(a={targetPage:o.classInfo.textInfo.curPage-1});break;case"nextPage":o.classInfo.textInfo.curPage+1<=o.classInfo.textInfo.countPage&&(a={targetPage:o.classInfo.textInfo.curPage+1});break;case"update_tea":a={targetPage:o.classInfo.serverInfo.curPage}}a&&r.agentTools("gopage",a)}),document.getElementById("pageNumber").addEventListener("click",function(){this.select()}),document.getElementById("pageNumber").addEventListener("change",function(){if(this.value<=o.classInfo.textInfo.countPage&&this.value>0){var e={targetPage:this.value};r.agentTools("gopage",e)}else this.value=o.classInfo.textInfo.curPage})},toolChangeEvent:function(){var e=o.course.isMultiVC?"selectedBut_m":"selectedBut";if($(".outerCenter").bind("click",function(t){if(o.user.teaLogin&&o.course.canDraw&&!o.board.pauseDraw){t=t||window.event||arguments.callee.caller.arguments[0];var a=""!==t.target.id?t.target.id:t.target.className,s=null;switch(a){case"hand_pen":s={type:"pen"},$("#tools_handle span").removeClass(e),$("#tools_handle").find("#hand_pen").addClass(e);break;case"hand_signpen":s={type:"signpen"},$("#tools_handle span").removeClass(e),$("#tools_handle").find("#hand_signpen").addClass(e);break;case"hand_rec":s={type:"rec"},$("#tools_handle span").removeClass(e),$("#tools_handle").find("#hand_rec").addClass(e);break;case"hand_text":s={type:"text",size:"big"},$("#chose_font").show(),$("#chose_font").focus(),$("#tools_handle span").removeClass(e),$("#tools_handle").find("#hand_text").addClass(e);break;case"hand_text selectedBut":s={type:"text",size:"big"},$("#tools_handle span").removeClass(e),$("#chose_font").show(),$("#chose_font").focus();break;case"hand_rub":s={type:"rub"},$("#tools_handle span").removeClass(e),$("#tools_handle").find("#hand_rub").addClass(e);break;case"hand_newrub":s={type:"newrub"},$("#tools_handle span").removeClass(e),$("#tools_handle").find("#hand_newrub").addClass(e);break;case"hand_draft":s={type:"draft"},$("#tools_handle span").removeClass(e),$("#tools_handle").find("#hand_draft").addClass(e);break;case"hand_back":s={type:"back"};break;case"hand_clear":s={type:"clear"};break;case"hand_magic":s={left:$("#tools_handle").find("#hand_magic").offset().left+"",top:$("#tools_handle").find("#hand_magic").offset().top+"",ori:"0"},n.sendCommData("magic",JSON.stringify(s)),s=null;break;case"font_small":s={type:"text",size:"small"},$("#tools_handle span").removeClass(e),$("#chose_font").find(".font_big").removeClass("selectedFont"),$("#chose_font").find(".font_small").addClass("selectedFont"),$("#chose_font").removeClass("chose_font_big").addClass("chose_font_small"),$("#tools_handle").find("#hand_text").addClass(e);break;case"font_big":s={type:"text",size:"big"},$("#tools_handle span").removeClass(e),$("#chose_font").find(".font_small").removeClass("selectedFont"),$("#chose_font").find(".font_big").addClass("selectedFont"),$("#chose_font").removeClass("chose_font_small").addClass("chose_font_big"),$("#tools_handle").find("#hand_text").addClass(e)}s&&r.agentTools("tools",s)}}),$("#chose_font").blur(function(){$("#chose_font").hide()}),o.moduleSet.tools){var t={type:"pen"};r.agentTools("tools",t)}$("#tools_handle").find("#hand_pen").addClass(e)},barScrollEvent:function(){var e=$("#scrollbar1").find(".thumb")[0].offsetTop,t=$("#scrollbar1").find(".thumb")[0].offsetHeight,a=$("#scrollbar1").find(".track")[0].offsetHeight,r=(o.classInfo.textInfo.height-a)/(a-t);if(0!=t&&s.topScroll!=e){var i={totalHeight:o.classInfo.textInfo.height,scrollTop:parseInt(e*r),CurrentPage:o.classInfo.textInfo.curPage-1};n.sendCommData("scroll",JSON.stringify(i))}s.topScroll=e},resizeEvent:function(){var e=($("#mainContainer").width(),$("#mainContainer").height());o.moduleSet.contain&&(o.moduleSet.page&&!o.course.isMultiVC?$("#workSpace").height(e-$("#toolbar_id").height()):$("#workSpace").height(e)),$("#showDomain").css({width:$("#workContainer").width(),height:$("#workContainer").height()}),$(".outerCenter").css("left",function(){return $("#mainContainer").width()/2-$(".outerCenter").width()/2+"px"}),o.moduleSet.tools&&$(".outerCenter").show(),window.iFrameParIO.resizeEventO()},timeTipEvent:function(){var e=(new Date).getTime(),t=o.course.localTime,a=o.course.startedTime,n=Math.max(e-t+a,0)/1e3,r=Math.round(n/60-.5),s=Math.round(n%60-.5);r=r<10?"0"+r:r+"",s=s<10?"0"+s:s+"",$(".timeTipCon").find(".timeInfo").html("<span>"+r+":"+s+"</span>")},getOffset:function(e,t){return t||(t={},t.top=0,t.left=0),e==document.body?t:(t.top+=e.offsetTop,t.left+=e.offsetLeft,s.getOffset(e.parentNode,t))},throttleStep:function(e,t){clearTimeout(e.tid),e.tid=setTimeout(function(){e.call(t)},50)},ccLayer:function(){$("#layerCon").bind("click",function(e){e.preventDefault(),e.stopPropagation()})},createBoardMenu:function(){document.getElementById("workContainer").oncontextmenu=function(e){if("h5Course"===o.host.textType){var t=e.pageX,a=e.pageY,n=$(this).width(),r=$(this).height(),s=t,i=a;t+200>n&&(s=s-(t+200-n)-$(".scrollbar").width()),a+60>r&&(i=i-(a+60-r)-5),$("#popMenuBox").css({left:s+"px",top:i+"px"}).show()}},$("#popMenuBox").on("click","li",function(){$("#popMenuBox").hide(),$("#paintBoard").hide()}),$("#workContainer").click(function(e){$("#popMenuBox").is(":visible")&&($("#popMenuBox").hide(),e.stopPropagation())}),window.addEventListener("blur",function(e){$("#popMenuBox").is(":visible")&&$("#popMenuBox").hide()})}};t.eventStart=function(){s.bind()}}),define("moduleSet",["boardConf","animate"],function(e,t,a){var o=e("boardConf").conf,n=e("animate").animate,a={loadModule:function(){var e=o.moduleSet;e.contain&&(console.log("[%s] -----------\x3e load contain",window.getTimeNow()),a.moduleContain()),e.course&&(console.log("[%s] -----------\x3e load course",window.getTimeNow()),a.moduleCourse(o.host.textType)),e.board&&(console.log("[%s] -----------\x3e load board",window.getTimeNow()),a.moduleBoard()),e.page&&(console.log("[%s] -----------\x3e load page",window.getTimeNow()),a.modulePage()),e.tools&&(console.log("[%s] -----------\x3e load tools",window.getTimeNow()),a.moduleTools()),e.update&&(console.log("[%s] -----------\x3e load update",window.getTimeNow()),a.moduleUpdate()),e.dataScroll&&(console.log("[%s] -----------\x3e load scroll data",window.getTimeNow()),a.moduleDataScroll()),e.dataFixed&&(console.log("[%s] -----------\x3e load fiexd data",window.getTimeNow()),a.moduleDataFixed()),e.ccLayer&&(console.log("[%s] -----------\x3e load cc layer",window.getTimeNow()),a.moduleCCLayer()),e.timeTip&&(console.log("["+window.getTimeNow()+"]-----------\x3eload time tip"),a.moduleTimeTip()),e.switch&&a.loadSwitch(),n.init()},loadSwitch:function(){var e=$("<a class='btn-switch'>Switch Material</a>");e.hide(),e.click(function(){window.comm_type_send("H5ChangeBook","{}")}),$(".toolContain").append(e)},moduleContain:function(){$("#mainContainer").append('<div class="workSpace" id="workSpace"><div id="scrollbar1"><div class="viewport" id="dsa"><div class="overview" id="overview"><div id="workContainer"><iframe class="showDomain" id="showDomain" scrolling="no"></iframe></div></div></div><div class="scrollbar"><div class="track"><div class="thumb" id="scroll1_thumb"><div class="end"></div></div></div></div></div></div>'),$("#scrollbar1").tinyscrollbar(),"teen"==o.host.classType?$("#workSpace").css("background-color","rgb(248,243,232)"):"1v1"==o.course.courseType&&$("#workSpace").css("background-color","rgb(239,243,247)")},modulePage:function(){var e=o.course.isMultiVC&&"toolbarRight_m"||"toolbarRight",t='<div class="toolbar" id="toolbar_id"><div class="toolContain"><div class="toolbarLeft"></div><div class="toolbarCenter"></div><div class="'+e+'"><ul><li class="item_update"><span id="update_tea" title = "同步"></span></li><li class="item_pre forbid"><span title="上一页" id="previousPage"></span></li><li class="item_num"><input type="tel" id="pageNumber" value="1"/></li><li class="item_count"><span id="numPages"></span></li><li class="item_next"><span title="下一页" id="nextPage"  tabindex="14"></span></li></ul></div></div></div>';$("#mainContainer").append(t),o.course.isMultiVC&&$("#toolbar_id").css({right:"0px"}),"en"==o.host.language&&($("#previousPage").attr("title","Previous Page"),$("#nextPage").attr("title","Next Page"),$("#update_tea").attr("title","updatePage"))},moduleTools:function(){var e='<div class="outerCenter"><ul class="centerBak"><li id="chose_font" tabindex="-1"><span class="font_small"></span><span class="font_big"></span></li><li class="'+(o.course.isMultiVC?"tools_handle_m":"tools_handle")+'" id="tools_handle">';if(console.log("["+window.getTimeNow()+"]-----------\x3eload fiexd data"),"en"==o.host.language)var t='<span class="hand_pen" id="hand_pen" stitle="画笔" title = "pen"></span>',a='<span class="hand_signpen" id="hand_signpen" stitle="荧光笔" title = "signpen"></span>',n='<span class="hand_rec" id="hand_rec" stitle="矩形" title = "rect"></span>',r='<span class="hand_text" id="hand_text" stitle="文字" title = "text"></span>',s='<span class="hand_rub" id="hand_rub" stitle="橡皮擦" title = "eraser"></span>',i='<span class="hand_newrub" id="hand_newrub" stitle="橡皮擦" title = "eraser"></span>',c='<span class="hand_draft" id="hand_draft" stitle="拖动" title = "move"></span>',l='<span class="hand_back" id="hand_back" stitle="回退" title = "undo"></span>',d='<span class="hand_clear" id="hand_clear" stitle="清除" title = "clear"></span>',u='<span class="hand_magic" id="hand_magic" style="display: none" title = "magic"></span>';else var t='<span class="hand_pen" id="hand_pen" stitle="画笔" title = "画笔"></span>',a='<span class="hand_signpen" id="hand_signpen" stitle="荧光笔" title = "荧光笔"></span>',n='<span class="hand_rec" id="hand_rec" stitle="矩形" title = "矩形"></span>',r='<span class="hand_text" id="hand_text" stitle="文字" title = "文字"></span>',s='<span class="hand_rub" id="hand_rub" stitle="橡皮擦" title = "橡皮擦"></span>',i='<span class="hand_newrub" id="hand_newrub" stitle="橡皮擦" title = "橡皮擦"></span>',c='<span class="hand_draft" id="hand_draft" stitle="拖动" title = "拖动"></span>',l='<span class="hand_back" id="hand_back" stitle="回退" title = "回退"></span>',d='<span class="hand_clear" id="hand_clear" stitle="清除" title = "清除"></span>',u='<span class="hand_magic" id="hand_magic" style="display: none" title = "魔法表情"></span>';var p=0,f="",g=[];o.host.tools.text&&(f=0==p?"hand_text":f,e+=r,p++,g.push("text")),o.host.tools.pen&&(f=0==p?"hand_pen":f,e+=t,p++,g.push("pencil")),o.host.tools.rec&&(f=0==p?"hand_rec":f,e+=n,p++,g.push("rectangle")),o.host.tools.signpen&&(f=0==p?"hand_signpen":f,e+=a,p++,g.push("highlighter")),o.host.tools.rub&&(f=0==p?"hand_rub":f,e+=s,p++,g.push("rubber")),o.host.tools.newrub&&(f=0==p?"hand_newrub":f,e+=i,p++,g.push("rubber")),o.host.tools.back&&(f=0==p?"hand_back":f,e+=l,p++,g.push("back")),o.host.tools.clear&&(f=0==p?"hand_clear":f,e+=d,p++,g.push("clear")),o.host.tools.draft&&(f=0==p?"hand_draft":f,e+=c,p++,g.push("drag")),"tea"==o.user.type&&(f=0==p?"hand_magic":f,e+=u,g.push("magic")),e+="</li></ul></div>";$("#mainContainer").append(e),""==f?$(".outerCenter").hide():("en"==o.host.language?("tea"!=o.user.type&&$("#tools_handle span").attr("title","The teacher is not in classroom, can't use these tools"),$("#tools_handle span").each(function(){$(this).attr("stitle",g.shift())})):"tea"!=o.user.type&&$("#tools_handle span").attr("title","老师不在教室，不能使用白板工具"),o.course.isMultiVC?($("#"+f).css("margin-left","15px"),$("#tools_handle").css("width",30+44*p+"px"),$("#chose_font").css("margin-left","13px"),$("#chose_font").find(".font_big").addClass("selectedFont"),$("#chose_font").removeClass("chose_font_small").addClass("chose_font_big")):($("#"+f).css("margin-left","15px"),$("#chose_font").css("margin-left","1px"),$("#chose_font").find(".font_small").addClass("selectedFont"),$("#chose_font").removeClass("chose_font_big").addClass("chose_font_small")))},moduleDataScroll:function(){$("#mainContainer").append('<div class="scroll_tea"></div>'),"teen"==o.host.classType&&$(".scroll_tea").css("background-color","rgb(250, 237, 192)")},moduleDataFixed:function(){$("#mainContainer").append('<div class="fixdata_tea"><div style="position: relative;width: 100%;height: 100%;"><span>Your lesson is recorded for quality purposes. And a quality evaluator might be observing your lesson.</span><div id="data_close"></div></div></div>'),"teen"==o.host.classType?($(".fixdata_tea").css("background-color","rgb(98, 97, 93)"),$(".fixdata_tea").css("cursor",o.cursor.teen.normal)):$(".fixdata_tea").css("cursor",o.cursor.normal.normal)},moduleTimeTip:function(){$("#mainContainer").append('<div class="timeTipCon"><div class="timeInfo"><span>00:00</span></div></div>')},moduleUpdate:function(){if($("#mainContainer").append('<div id="update_cue"><ul><li class="l1_close"><span id="cue_close"></span></li><li class="l2_info"><span>AC教室又增加新功能啦，升级后即可使用.提示：可在AC主界面左下角系统菜单中点击升级</span></li><li class="l3_chose"><span id="cue_stop" class="cue_stop">不再提示</span></li></ul></div>'),"en"==o.host.language){$("#update_cue").find(".l2_info").html('<span>New functions in AC,try after upgrading it!Tips: Click on "Upgrade" in the MENU at  the AC main page.</span>'),$("#update_cue").find(".cue_stop").html("Don't ask me again")}},moduleCCLayer:function(){$("#mainContainer").append('<div id="layerCon"></div>')},moduleBoard:function(){$("#workContainer").append('<div id="paintBoard" class="paintBoard"><div style="position: relative;width: 100%;height: 100%"><div id="input" autofocus="autofocus" tabindex="-1"><p id="edit" contenteditable="plaintext-only"></p></div><div id="mouseTea"><canvas id="canvasMouse" width="20" height="20"></canvas></div><canvas class="canvas" id="canvas">浏览器不支持</canvas><canvas class="canvas" id="canvas_bak" tabindex="-1"></canvas></div></div><div id="inputBakContain"><span id="inputBak"></span><div>'),"teen"==o.host.classType?("tea"!==o.user.type?$("#canvas_bak").css("cursor",o.cursor.teen.forbidden):($("#canvas_bak").css("cursor",o.cursor.teen.normal),o.board.pauseDraw=!1),$("#mouseTea").css({width:o.cursor.teen.size.wid+"px",height:o.cursor.teen.size.hei+"px","background-image":o.cursor.teen.ferule}),$("#input").css("cursor",o.cursor.teen.draft)):("tea"!==o.user.type?$("#canvas_bak").css("cursor",o.cursor.normal.forbidden):($("#canvas_bak").css("cursor",o.cursor.teen.normal),o.board.pauseDraw=!1),$("#mouseTea").css({width:o.cursor.normal.size.wid+"px",height:o.cursor.normal.size.hei+"px","background-image":o.cursor.normal.ferule}),$("#input").css("cursor",o.cursor.normal.draft)),"h5Course"===o.host.textType&&("tea"===o.user.type&&$("#paintBoard").css("background-color",o.h5Course.canvasColor),$("#paintBoard").hide())},moduleCourse:function(e){switch(e){case"pdf":$("#showDomain").attr("src","./courseLoad/pdf/pdf.html");break;case"h5Course":$("#showDomain").attr("src",o.host.textUrl.h5Course.urlControl+"?"+(new Date).getTime())}window.iFrameParIO.parentCon=$(window.parent.document).contents().find("#showDomain")[0].contentWindow}};t.loadModuleStart=function(){a.loadModule()}}),define("animate",["boardConf"],function(e,t,a){var o=e("boardConf").conf,n={timeid:0,autoTime:6e4,id:0,btnVisible:!1,init:function(){var e,t,a=$("<div class='anime'><iframe scrolling='no'></iframe><div class='btns'></div></div>");"en"==o.host.language?(e=$("<a class='btn-play'>replay</a>"),t=$("<a class='btn-close'>close</a>")):(e=$("<a class='btn-play'>重播</a>"),t=$("<a class='btn-close'>关闭</a>"));var r=a.find(".btns");r.append(e),r.append(t),r.hide(),$(document.body).append(a),a.hide();var s=$(".anime iframe");s.get(0);e.click(function(){n.replay()}),t.click(function(){n.close()}),n.showButton(n.btnVisible),window.animeComplete=function(){console.log("动画播放完毕");var e={type:"stop",id:n.id};window.comm_type_send("animate",JSON.stringify(e))}},replay:function(){var e=$(".anime"),t=(e.find(".btns"),$(".anime iframe")),a=t.get(0);e.show(),a.contentWindow.exportRoot.gotoAndPlay(1);var o={type:"play",id:n.id};window.comm_type_send("animate",JSON.stringify(o))},close:function(){var e=$(".anime"),t=$(".anime iframe");e.hide(),t.attr("src","");var a={type:"close",id:n.id};window.comm_type_send("animate",JSON.stringify(a))},play:function(e){var t=$(".anime"),a=(t.find(".btns"),$(".anime iframe"));t.show(),a.attr("src",e)},stop:function(){clearTimeout(n.timeid);var e=$(".anime"),t=$(".anime iframe");e.hide(),t.attr("src","")},showButton:function(e){n.btnVisible=e;var t=$(".anime .btns");e?t.show():t.hide()}};t.animate=n}),define("enDataSend",["boardConf"],function(e,t,a){var o=e("boardConf").conf;t.sendCommData=function(e,t){("paint"!==e||"h5Course"!==o.host.textType||o.h5Course.startClass)&&window.comm_type_send(e,t)}}),define("moduleTools",["boardConf","whiteBoard","enDataSend"],function(e,t,a){function o(e,t){return 1==e?($("#toolbar_id .item_pre").addClass("forbid"),void $("#toolbar_id .item_next").removeClass("forbid")):e==t?($("#toolbar_id .item_pre").removeClass("forbid"),void $("#toolbar_id .item_next").addClass("forbid")):($("#toolbar_id .item_pre").removeClass("forbid"),void $("#toolbar_id .item_next").removeClass("forbid"))}var n=e("boardConf").conf,r=e("whiteBoard"),s=e("enDataSend"),i={operAgent:function(e,a){switch("pageclick"==e&&(e="gopage"),e){case"paint":r.showCefPaint(a);break;case"mouse":if(n.classInfo.textInfo.curPage==n.classInfo.serverInfo.curPage&&("tea"!=n.user.type||"1vN"!=n.course.courseType)){$("#mouseTea").show(),n.board.mouse.mouseSign=0;var c=n.classInfo.drawInfo.width/a.canvasWidth;$("#mouseTea").animate({left:a.mouseX*c,top:a.mouseY*c},"fast")}break;case"scroll":var l=($("#scrollbar1").find(".thumb")[0].offsetTop,$("#scrollbar1").find(".thumb").height()),d=$("#scrollbar1").find(".track")[0].offsetHeight,u=n.classInfo.textInfo.height;if(0!=d&&n.classInfo.textInfo.curPage==n.classInfo.serverInfo.curPage&&"tea"!=n.user.type){var p=u/a.totalHeight,f=a.scrollTop*p,g=(d-l)/(u-d);f>u-$("#overview").height()&&(f=u-$("#overview").height()),$("#scrollbar1").find(".thumb").animate({top:f*g},"fast"),$("#overview").animate({top:-1*f},"fast")}break;case"page":if("pdf"===n.host.textType||a.type&&"pageNew"===a.type){n.classInfo.serverInfo.curPage=parseInt(a.CurrentPage)+1,n.classInfo.textInfo.curPage!=n.classInfo.serverInfo.curPage&&(n.classInfo.textInfo.curPage=n.classInfo.serverInfo.curPage,window.iFrameParIO.setPageO(n.classInfo.textInfo.curPage)),n.moduleSet.page&&($("#pageNumber").val(n.classInfo.serverInfo.curPage),o(n.classInfo.serverInfo.curPage,n.classInfo.serverInfo.countPage),$(".item_update").hide());var h={cur:n.classInfo.textInfo.curPage-1,count:n.classInfo.textInfo.countPage};s.sendCommData("teenpage",JSON.stringify(h)),n.moduleSet.board&&n.course.canDraw&&n.user.teaLogin&&n.classInfo.serverInfo.curPage==n.classInfo.textInfo.curPage&&(console.log("[%s] -----------\x3e update board to pause draw(false) when page and page number is same",window.getTimeNow()),n.board.pauseDraw=!1,t.updateBoardConf({pauseDraw:!1})),r.rePaint(),t.agentTools("tools",{type:n.board.curToolType})}else n.pdf.curPage=parseInt(a.CurrentPage)+1;break;case"pageNew":if(console.log("[%s] -----------\x3e pageNew handle,handle info :%s",window.getTimeNow(),JSON.stringify(a)),n[a.Type].curPage=parseInt(a.CurrentPage)+1,n[a.Type].countPage=parseInt(a.TotalPage),a.Type==n.host.textType){var m={CurrentPage:n[a.Type].curPage-1,TotalPage:n[a.Type].countPage,type:"pageNew"};i.operAgent("page",m)}break;case"updateStuPage":var w=parseInt(a.targetPage),m={TotalPage:n.classInfo.textInfo.countPage,CurrentPage:w-1};"pdf"===n.host.textType?(console.log("[%s] -----------\x3e %s send page data to server,type : updateStuPage(%s %s)",window.getTimeNow(),n.user.type,m.CurrentPage,m.TotalPage),s.sendCommData("page",JSON.stringify(m))):"h5Course"===n.host.textType&&(m.Type=n.host.textType,console.log("[%s] -----------\x3e %s send pageNew data to server,type : updateStuPage(%s %s %s)",window.getTimeNow(),n.user.type,m.CurrentPage,m.TotalPage,m.Type),s.sendCommData("pageNew",JSON.stringify(m)));break;case"gopage":var w=parseInt(a.targetPage),v=n.classInfo.textInfo.curPage-1;if(window.iFrameParIO.setPageO(w),n.classInfo.textInfo.curPage=w,"tea"==n.user.type){if("h5Course"===n.host.textType&&n.h5Course.startClass||"pdf"===n.host.textType){n.classInfo.serverInfo.curPage=w,n[n.host.textType].curPage=n.classInfo.serverInfo.curPage,t.agentTools("tools",{type:"clear"});var m={TotalPage:n.classInfo.textInfo.countPage,CurrentPage:n.classInfo.textInfo.curPage-1};"pdf"===n.host.textType?(console.log("[%s] -----------\x3e %s send page data to server,type : updateStuPage(%s %s)",window.getTimeNow(),n.user.type,m.CurrentPage,m.TotalPage),s.sendCommData("page",JSON.stringify(m))):"h5Course"===n.host.textType&&(m.Type=n.host.textType,console.log("[%s] -----------\x3e %s send pageNew data to server,type : updateStuPage(%s %s %s)",window.getTimeNow(),n.user.type,m.CurrentPage,m.TotalPage,m.Type),s.sendCommData("pageNew",JSON.stringify(m)))}var h={cur:n.classInfo.textInfo.curPage-1,count:n.classInfo.textInfo.countPage};console.log("[%s] -----------\x3e %s send teenpage data to server,type : gopage",window.getTimeNow(),n.user.type),s.sendCommData("teenpage",JSON.stringify(h))}else n.classInfo.textInfo.curPage!=n.classInfo.serverInfo.curPage?(n.moduleSet.page&&$(".item_update").show(),n.user.teaLogin&&(n.board.pauseDraw=!0,console.log("[%s] -----------\x3e update board to pause draw(true) when gopage",window.getTimeNow()),t.updateBoardConf({pauseDraw:!0}),"teen"==n.host.classType?($("#canvas_bak").css("cursor",n.cursor.teen.forbidden),$("#showDomain").css("cursor",n.cursor.teen.forbidden)):($("#canvas_bak").css("cursor",n.cursor.normal.forbidden),$("#showDomain").css("cursor",n.cursor.normal.forbidden))),r.clearPaint()):(n.moduleSet.page&&$(".item_update").hide(),n.user.teaLogin&&(console.log("[%s] -----------\x3e update board to pause draw(false) when gopage and page number is same and teacher is in class",window.getTimeNow()),n.board.pauseDraw=!1,t.updateBoardConf({pauseDraw:!1}),t.agentTools("tools",{type:n.board.curToolType})),r.rePaint());n.moduleSet.page&&($("#pageNumber").val(n.classInfo.textInfo.curPage),o(n.classInfo.textInfo.curPage,n.classInfo.textInfo.countPage)),s.sendCommData("pageNotify",JSON.stringify({cur:v,target:n.classInfo.textInfo.curPage-1,action:n.classInfo.textInfo.curPage-1>v?2:1}));break;case"tools":console.log("[%s] -----------\x3e tools handle,handle info :%s",window.getTimeNow(),JSON.stringify(a)),n.board.pauseDraw&&"tea"===n.user.type&&(n.board.pauseDraw=!1),n.board.pauseDraw?("teen"==n.host.classType?$("#canvas_bak").css("cursor",n.cursor.teen.forbidden):$("#canvas_bak").css("cursor",n.cursor.normal.forbidden),console.log("[%s] -----------\x3e update board to pause draw(true) when tools",window.getTimeNow()),r.setBoardConf({pauseDraw:!0})):(console.log("[%s] -----------\x3e update board to pause draw(false) when tools and conf data pauseDraw is false",window.getTimeNow()),r.setBoardConf({pauseDraw:!1}),i.operDraw(a));break;case"addTool":if(n.moduleSet.tools&&a.magic){$(".outerCenter").show(),$("#tools_handle").find("#hand_magic").show();var y=$("#tools_handle").width();$("#tools_handle").css("width",y+22+"px")}break;case"startPractice":s.sendCommData("startPractice",JSON.stringify(a));break;case"startClass":s.sendCommData("startClass",JSON.stringify(a));break;case"backFirst":var m={targetPage:1};i.operAgent("gopage",m);break;case"canvas":"open"===a.type?($("#paintBoard").show(),r.rePaint()):$("#paintBoard").hide();break;case"otherEnter":var m={type:"otherEnter",identify:a.type};window.iFrameParIO.H5Course.notify(m);break;default:console.error("[%s] -----------\x3e unKnow agent type : %s",window.getTimeNow(),e)}},operDraw:function(e){if(n.course.canDraw&&!n.board.pauseDraw){var t="teen"==n.host.classType,a=n.cursor.teen,o=n.cursor.normal;switch(e.type){case"pen":$("#canvas_bak").css("cursor",""),t?$("#canvas_bak").css("cursor",a.pen):$("#canvas_bak").css("cursor",o.pen),n.board.curToolType=e.type;break;case"signpen":$("#canvas_bak").css("cursor",""),t?$("#canvas_bak").css("cursor",a.signpen):$("#canvas_bak").css("cursor",o.signpen),n.board.curToolType=e.type;break;case"rec":$("#canvas_bak").css("cursor",""),t?$("#canvas_bak").css("cursor",a.rec):$("#canvas_bak").css("cursor",o.rec),n.board.curToolType=e.type;break;case"rub":$("#canvas_bak").css("cursor",""),t?$("#canvas_bak").css("cursor",a.rub):$("#canvas_bak").css("cursor",o.rub),n.board.curToolType=e.type;break;case"newrub":$("#canvas_bak").css("cursor",""),t?$("#canvas_bak").css("cursor",a.newrub):$("#canvas_bak").css("cursor",o.newrub),n.board.curToolType=e.type;break;case"text":$("#Center_chose")&&$("#Center_chose").css("display","none"),$("#canvas_bak").css("cursor",""),t?$("#canvas_bak").css("cursor",a.text):$("#canvas_bak").css("cursor",o.text);var i="big"==e.size?n.board.font.big:n.board.font.small,c={font:{fontSize:i}};r.setBoardConf(c),n.board.curToolType=e.type;break;case"draft":$("#canvas_bak").css("cursor",""),t?$("#canvas_bak").css("cursor",n.cursor.teen.draft):$("#canvas_bak").css("cursor",n.cursor.normal.draft),n.board.curToolType=e.type;break;case"back":var l={handleType:1,drawingType:1,specialValue:null};s.sendCommData("paint",JSON.stringify(l));break;case"clear":var l={handleType:1,drawingType:2,specialValue:null};s.sendCommData("paint",JSON.stringify(l));break;default:console.error("[%s] -----------\x3e unKnow draw type : %s",window.getTimeNow(),e.type)}r.draw(e.type)}}};t.initPageNum=function(e){s.sendCommData("teenpage",JSON.stringify(e))},t.agentTools=function(e,t){i.operAgent(e,t)},t.updateBoardConf=function(e){r.setBoardConf(e)},t.reviewCanvas=function(e,t,a,o){r.resizePaint(e,t,a,o)}}),define("loadHtmlModule",["moduleSet","eventBind"],function(e,t,a){
t.loadStart=function(){console.log("[%s] -----------\x3e load html",window.getTimeNow()),e("moduleSet").loadModuleStart(),console.log("[%s] -----------\x3e bind event",window.getTimeNow()),e("eventBind").eventStart()}}),define("logicUnpack",["boardConf","loadHtmlModule","moduleTools","enDataSend","animate"],function(e,t,a){var o=e("boardConf").conf,n=e("loadHtmlModule"),r=e("moduleTools"),s=e("enDataSend"),i=e("animate").animate,c=function(e,t,a){var o=0,n=0,r=e,s=t;switch(parseInt(a)){case 0:break;case 1:r=732*e/1e3,s=r/2,o=265*e/1003,n=117*t/503;break;case 2:r=268768*e/367500,s=153853*r/268768,o=870*e/3675,n=49244*t/21e4}return{marginX:parseInt(o),marginY:parseInt(n),width:parseInt(r),height:parseInt(s)}};window.iFrameParIO={parentCon:null,initI:function(e,t){console.log("[%s] -----------\x3e init page data: {curpage: %d ,countpage: %d }",window.getTimeNow(),e,t),o.classInfo.textInfo.curPage=parseInt(e),o.classInfo.textInfo.countPage=parseInt(t),o[o.host.textType].countPage=parseInt(t),o.classInfo.serverInfo.countPage=parseInt(t),o.classInfo.serverInfo.curPage=o[o.host.textType].curPage,o.classInfo.serverInfo.curPage!=o.classInfo.textInfo.curPage&&r.agentTools("gopage",{targetPage:o.classInfo.serverInfo.curPage}),"h5Course"!==o.host.textType&&("teen"==o.host.classType?this.parentCon.document.body.style.cursor=o.cursor.teen.normal:this.parentCon.document.body.style.cursor=o.cursor.normal.normal),o.moduleSet.page&&($("#numPages").text("/ "+t),$("#toolbar_id").css("display","inline-block")),o.classInfo.drawInfo.ready=!0,l.clearCache(),r.agentTools("tools",{type:o.board.curToolType})},dataDrawI:function(e,t,a,n){var s=null;if(s="h5Course"===o.host.textType?{marginX:a,marginY:n,width:e,height:t}:c(e,t,o.course.metrialType),o.classInfo.textInfo.width=e,o.classInfo.textInfo.height=t,o.classInfo.drawInfo.width=s.width,o.classInfo.drawInfo.height=s.height,e=Math.max(e,$("#showDomain").width()),t=Math.max(t,$("#showDomain").height()),$("#showDomain").css({height:t}),o.moduleSet.board){var i=0,l=0,d=0,u=0;"h5Course"===o.host.textType?(i=s.width,l=s.height,d=s.marginX,u=s.marginY):(i=s.width,l=s.height,d=a+s.marginX+($("#workSpace").width()-e)/2,u=n+s.marginY),r.reviewCanvas(i,l,d,u)}$("#scrollbar1").tinyscrollbar_update()},removeScrollI:function(e){console.log("[%s] -----------\x3e height taller and remove scroll",window.getTimeNow()),$("#showDomain").width(e),$("#showDomain").css("left",function(){return($("#workSpace").width()-e)/2}),"pdf"===o.host.textType?this.pdfCourse.resize():"h5Course"===o.host.textType&&this.H5Course.resize()},setPageO:function(e){"pdf"===o.host.textType?this.pdfCourse.setPage(e):"h5Course"===o.host.textType&&this.H5Course.setPage(e)},resetModuleO:function(){$("#showDomain").css("left",0),this.parentCon.resetscroll=!0},resizeEventO:function(){"pdf"===o.host.textType?this.pdfCourse.resize():"h5Course"===o.host.textType&&this.H5Course.resize()},getUrlO:function(){return o.host.textUrl},loadMes:function(e){window.comm_type_send("load",e)},pdfCourse:{resize:function(){window.iFrameParIO.parentCon.handleChlIO.resize(),setTimeout(function(){window.iFrameParIO.pdfCourse.setPage(o.classInfo.textInfo.curPage)},10)},setPage:function(e){window.iFrameParIO.parentCon.handleChlIO.setPage(e)}},changeCourse:function(e){if(console.log("[%s] -----------\x3e change course to %s",window.getTimeNow(),e.targetCourse),o.classInfo.drawInfo.ready=!1,"pdf"===e.targetCourse){if(e.urlData&&e.urlData.url){var t=window.MyBase64.decode(e.urlData.url);t.split("?")[0]!=o.host.textUrl.pdf.split("?")[0]&&(console.log("[%s] -----------\x3e urlData is %s",window.getTimeNow(),JSON.stringify(e.urlData)),o.pdf.curPage=1,o.host.textUrl.pdf=t)}o.host.textType="pdf",$("#paintBoard").show(),$("#paintBoard").css("background-color","transparent"),("stu"===o.user.type&&"1v1"===o.course.courseType||"tea"===o.user.type)&&(console.log("[%s] -----------\x3e update board to canDraw(true) when changeCourse(1v1 stu pdf)",window.getTimeNow()),o.course.canDraw=!0,r.updateBoardConf({paintModule:"draw"})),$("#showDomain").attr("src","./courseLoad/pdf/pdf.html?"+(new Date).getTime()),window.iFrameParIO.parentCon=$(window.parent.document).contents().find("#showDomain")[0].contentWindow}else"h5Course"===e.targetCourse&&(e.urlData&&e.urlData.countNum&&(o.h5Course.curPage=1,console.log("[%s] -----------\x3e urlData is %s",window.getTimeNow(),JSON.stringify(e.urlData)),o.host.textUrl.h5Course=e.urlData),o.host.textType="h5Course","h5Course"===o.host.textType&&"tea"===o.user.type&&$("#paintBoard").css("background-color",o.h5Course.canvasColor),$("#paintBoard").hide(),$("#showDomain").attr("src",o.host.textUrl.h5Course.urlControl+"?"+(new Date).getTime()))},H5Course:{init:function(){if(void 0===window.iFrameParIO.parentCon.sendSyncData){console.error("[%s] -----------\x3e failed to load controller.html,change course type!",window.getTimeNow());var e={type:"error"};return s.sendCommData("H5CourseLoad",JSON.stringify(e)),!1}var t=o.user,a="tea"==t.type?"in":t.teaLogin?"in":"out",n=o.course.courseType,r=o.host.language,i=o.course.courseId,c={userInfo:{userType:t.type,userId:t.userId,teaState:a},classInfo:{classType:n,language:r},courseInfo:{courseId:i,pageCount:o.host.textUrl.h5Course.countNum,headUrl:o.host.textUrl.h5Course.headUrl},startClass:o.h5Course.startClass,startPractice:o.h5Course.startPractice};return console.log("[%s] -----------\x3e parentIFrame : send init data :",window.getTimeNow()),console.log(c),window.iFrameParIO.parentCon.sendSyncData?window.iFrameParIO.parentCon.sendSyncData("init",c):console.error("[%s] -----------\x3e parentIFrame : error happened when send init data to child",window.getTimeNow()),window.iFrameParIO.initI(1,o.host.textUrl.h5Course.countNum),!0},resize:function(){if(!o.h5Course.resizeFirst){var e={type:"resize"};window.iFrameParIO.H5Course.notify(e)}o.h5Course.resizeFirst=!1},setPage:function(e){var t={type:"page",targetNum:e};window.iFrameParIO.H5Course.notify(t)},comm:function(e){var t=e;t.uuid=0,console.log("[%s] -----------\x3e parentIFrame : get data from svc and send to child",window.getTimeNow()),console.log(t),window.iFrameParIO.parentCon.sendSyncData?window.iFrameParIO.parentCon.sendSyncData("comm",t.specialValue.value):console.error("[%s] -----------\x3e parentIFrame : error happened when send svc data to child",window.getTimeNow())},notify:function(e){void 0!==window.iFrameParIO.parentCon.sendSyncData&&(console.log("[%s] -----------\x3e parentIFrame : send notify data",window.getTimeNow()),console.log(e),window.iFrameParIO.parentCon.sendSyncData?window.iFrameParIO.parentCon.sendSyncData("notify",e):console.error("[%s] -----------\x3e parentIFrame : error happened when send notify data to child",window.getTimeNow()))},sendMSG:function(e,t){switch(e){case"svcMes":console.log("[%s] -----------\x3e parentIFrame : get svcMes data :",window.getTimeNow()),console.log(t);var a={handleType:0,drawingType:400,id:1e3,specialValue:{value:t}};s.sendCommData("paint",JSON.stringify(a));break;case"loadData":break;case"startClass":"startClass"!==t.type||o.h5Course.startClass||(console.log("[%s] -----------\x3e parentIFrame : get startClass:",window.getTimeNow()),console.log(t),o.h5Course.startClass=!0,"tea"===o.user.type&&t.firstTime&&r.agentTools("gopage",{targetPage:"1"}));break;case"startPractice":"startPractice"!==t.type||o.h5Course.startPractice||(console.log("[%s] -----------\x3e parentIFrame : get startPractice:",window.getTimeNow()),console.log(t),o.h5Course.startPractice=!0,r.agentTools("startPractice",t));break;case"backFirst":"backFirst"===t.type&&(console.log("[%s] -----------\x3e parentIFrame : get backFirst:",window.getTimeNow()),console.log(t),"tea"===o.user.type&&r.agentTools("gopage",{targetPage:"1"}));break;case"updateStuPage":"tea"===o.user.type?(console.log("[%s] -----------\x3e parentIFrame : get updateStuPage:",window.getTimeNow()),console.log(t),r.agentTools("updateStuPage",{targetPage:t.targetPage})):console.error("[%s] -----------\x3e parentIFrame : error happened when stu get updateStuPage",window.getTimeNow());break;case"pageInit":console.error("[%s] -----------\x3e parentIFrame : wrong function is used!",window.getTimeNow()),console.error("wrong function is used!");break;case"boardSet":var n=t.top,i=t.left,c=t.width,l=t.height;console.log("[%s] -----------\x3e parentIFrame : set whiteBoard data :",window.getTimeNow()),console.log("                ----------------------------------\x3e(top,left,width,height)(%d,%d,%d,%d)",n,i,c,l),window.iFrameParIO.dataDrawI(c,l,i,n)}}}};var l={conf:{courseRole:{0:"student",1:"1v1 teacher",4:"open lecture teacher",5:"PSO student",6:"PSO teacher",7:"chinese teacher",64:"cc"},courseStyle:{0:"1v1",1:"open lecture",2:"multi video classroom",3:"experience lecture",4:"competitive Small-class-based lecture",5:"active open lecture",6:"PSO training lecture",7:"SA open lecture",8:"PT ways lecture",9:"CEGC(CE Unit lecture)",10:"chinese teacher lecture",12:"B2S open lecture",13:"class lecture"},userRole:{"-1":"guest",0:"student",1:"1v1 teacher",2:"experience user",3:"unKnow type",4:"1vn teacher",5:"PSO student",6:"PSO teacher",7:"chinese teacher",16:"control",64:"cc sales",65:"crit",99:"1vN administrator"},userType:{1:"teacher",2:"student",3:"administrator",4:"customer service"},textType:{0:"pdf",1:"ppt",2:"h5Course"},teaType:[1,4,6,7],stuType:[0,5]},init:function(e,t){switch(e){case"course":o.serverData.objCourseInfo=t,console.log("[%s] -----------\x3e objCourseInfo: %s",window.getTimeNow(),JSON.stringify(t));break;case"user":o.serverData.objUserInfo=t,console.log("[%s] -----------\x3e objUserInfo: %s",window.getTimeNow(),JSON.stringify(t));break;case"host":o.serverData.objHostInfo=t,console.log("[%s] -----------\x3e objHostInfo: %s",window.getTimeNow(),JSON.stringify(t));break;case"url":o.serverData.objURLInfo=t,console.log("[%s] -----------\x3e objURLInfo: %s",window.getTimeNow(),JSON.stringify(t));break;case"courseAll":o.serverData.objCourseAllInfo=t,console.log("[%s] -----------\x3e objCourseAllInfo: %s",window.getTimeNow(),JSON.stringify(t));break;default:return void console.warn("[%s] -----------\x3e objOtherInitInfo: %s",window.getTimeNow(),JSON.stringify(t))}if(null!=o.serverData.objCourseInfo&&null!=o.serverData.objUserInfo&&null!=o.serverData.objHostInfo&&null!=o.serverData.objURLInfo){var a=o.course,s=o.user,c=o.host,d=o.serverData;a.turnPage=void 0==d.objCourseInfo.CanTurnPage||1==d.objCourseInfo.CanTurnPage,a.metrialType=d.objCourseInfo.metrialtype||0,a.courseId=d.objCourseInfo.courseId||"",a.courseStyle=d.objCourseInfo.coursestyle&&l.conf.courseStyle[d.objCourseInfo.coursestyle]||"undefined",a.courseType=void 0!=d.objCourseInfo.coursestyle?0==d.objCourseInfo.coursestyle?"1v1":"1vN":"1v1",a.isMultiVC=2===d.objCourseInfo.coursestyle,a.startedTime=d.objCourseInfo.startedTime||0,s.type="other",void 0!=d.objCourseInfo.courserole&&(-1!=l.conf.teaType.indexOf(d.objCourseInfo.courserole)&&(s.type="tea"),-1!=l.conf.stuType.indexOf(d.objCourseInfo.courserole)&&(s.type="stu")),void 0!=d.objCourseInfo.courserole&&(64==d.objCourseInfo.courserole?s.type="cc":65==d.objCourseInfo.courserole&&(s.type="crit")),s.courseRole=d.objCourseInfo.courserole&&l.conf.courseRole[d.objCourseInfo.courserole]||"undefined",s.userRole=d.objUserInfo.userrole&&l.conf.userRole[d.objUserInfo.userrole]||"undefined",s.userType=d.objUserInfo.usertype&&l.conf.userType[d.objUserInfo.usertype]||"undefined",s.userId=d.objUserInfo.userid||"undefined",c.mainHost=d.objHostInfo.mainhost||"undefined",c.language=d.objHostInfo.language||"undefined",c.versionType=d.objHostInfo.versionType||"undefined",c.tipData.fixedData=void 0!=d.objHostInfo.tipdata&&(void 0!=d.objHostInfo.tipdata.fixdata&&d.objHostInfo.tipdata.fixdata),c.tipData.scrollData=void 0==d.objHostInfo.tipdata||(void 0==d.objHostInfo.tipdata.scrollData||d.objHostInfo.tipdata.fixedData),c.textType=d.objHostInfo.textType&&l.conf.textType[d.objHostInfo.textType]||"pdf",o.h5Course.open="pdf"!=c.textType,c.textUrl=d.objURLInfo||"undefined",c.classType=d.objHostInfo.showtype||"normal",c.tools=d.objHostInfo.toolsconf||c.tools,5==s.courseRole?o.board.stu.pencil.color="#FF0000":6==s.courseRole&&(o.board.tea.pencil.color="#0078FF"),void 0!=window.AcJs_get_encode&&(o.isSupportEncodeFunc=!0),("stu"===s.type&&"1v1"===a.courseType||"tea"===s.type)&&(console.log("[%s] -----------\x3e update board to canDraw(true) when initData(1v1 stu and tea)",window.getTimeNow()),a.canDraw=!0,r.updateBoardConf({paintModule:"draw"})),(c.tools.newrub||c.tools.draft)&&(o.board.version="new",r.updateBoardConf({version:"new"})),console.log("[%s] -----------\x3e result:",window.getTimeNow()),console.log("                                -----\x3euser: %s",JSON.stringify(s)),console.log("                                -----\x3ecourse: %s",JSON.stringify(a)),console.log("                                -----\x3ehost: %s",JSON.stringify(c));o.serverData.objCourseAllInfo.courseTypeEx;"tea"==s.type?(c.tipData.scrollData=!0,o.moduleSet.dataScroll=!0,o.event.barScroll=!0,o.event.mouse=!0,o.event.scrollData=!0,c.tipData.fixedData&&(o.event.fixedData=!0,o.moduleSet.dataFixed=!0),"1vN"!=o.course.courseType&&"1v1"!=o.course.courseType||(o.moduleSet.page=!0,o.moduleSet.tools=!0),"1v1"==o.course.courseType&&(o.moduleSet.dataScroll=!1,o.moduleSet.dataFixed=!1),i.showButton(!0)):"1vN"==o.course.courseType&&o.course.turnPage?o.moduleSet.page=!0:"1v1"==o.course.courseType&&(o.event.mouse=!0,o.moduleSet.page=!0,o.moduleSet.tools=!0),"mac"===o.host.mainHost&&(o.moduleSet.page=!0,o.moduleSet.tools=!0),a.isMultiVC&&(o.moduleSet.timeTip=!0,o.event.timeTip=!0,c.tipData.scrollData=!1,o.moduleSet.dataScroll=!1,o.event.fixedData=!1,o.moduleSet.dataFixed=!1),"cc sales"===s.userRole&&(o.moduleSet.ccLayer=!0),n.loadStart(),"tea"==s.type?(r.updateBoardConf(o.board.tea),s.teaLogin=!0,o.board.pauseDraw=!1,console.log("[%s] -----------\x3e update board to pause draw(false) when init and user type is tea",window.getTimeNow()),r.updateBoardConf({pauseDraw:!1})):r.updateBoardConf(o.board.stu),window.comm_type_send("h5_ready",JSON.stringify({}))}},update:function(e){if(o.classInfo.drawInfo.ready)if("enterout"==e.type){if("tea"!==o.user.type)if(o.user.teaLogin&&0==JSON.parse(e.jsonStr).Bl_E_O){if(console.log("[%s] -----------\x3e teacher out class",window.getTimeNow()),o.user.teaLogin=!1,o.board.pauseDraw=!0,console.log("[%s] -----------\x3e update board to pause draw(true) when teacher out class",window.getTimeNow()),r.updateBoardConf({pauseDraw:!0}),o.moduleSet.tools&&$("#outerCenter").css("display","none"),o.moduleSet.board&&r.agentTools("tools",{type:o.board.curToolType}),"h5Course"===o.host.textType){var t={type:"teaState",state:"out"};window.iFrameParIO.H5Course.notify(t)}"en"==o.host.language?$("#tools_handle span").attr("title","The teacher is not in classroom, can't use these tools"):$("#tools_handle span").attr("title","老师不在教室，不能使用白板工具")}else if(!o.user.teaLogin&&1==JSON.parse(e.jsonStr).Bl_E_O){if(console.log("[%s] -----------\x3e teacher enter class",window.getTimeNow()),o.user.teaLogin=!0,o.classInfo.serverInfo.curPage==o.classInfo.textInfo.curPage&&(console.log("[%s] -----------\x3e update board to pause draw(false) when teacher enter class and page number is same",window.getTimeNow()),o.board.pauseDraw=!1,r.updateBoardConf({pauseDraw:!1})),o.moduleSet.tools,o.course.canDraw&&o.moduleSet.board&&r.agentTools("tools",{type:o.board.curToolType}),"h5Course"===o.host.textType){var t={type:"teaState",state:"in"};window.iFrameParIO.H5Course.notify(t)}$("#tools_handle span").each(function(){$(this).attr("title",$(this).attr("stitle"))})}}else if("changebookbtn"==e.type){var a=JSON.parse(e.jsonStr),n=$(".toolContain .btn-switch");"true"==a.visible?n.show():n.hide()}else if("animate"==e.type){var a=JSON.parse(e.jsonStr);$(".anime"),$(".anime iframe");"true"==a.play?(i.id=a.id,i.play(a.path)):i.stop()}else{var a=JSON.parse(e.jsonStr);0==a.handleType&&"paint"==e.type&&a.drawingType==o.h5Course.idType?(console.log("[%s] -----------\x3e get data:",window.getTimeNow()),console.log(a),window.iFrameParIO.H5Course.comm(a)):r.agentTools(e.type,JSON.parse(e.jsonStr))}else o.boardDataCache.push(e),console.log("[%s] -----------\x3e canvas is not ready , push data to Array : %s",window.getTimeNow(),JSON.stringify(e))},clearCache:function(){var e={cur:o.classInfo.textInfo.curPage-1,count:o.classInfo.textInfo.countPage};if(r.initPageNum(e),o.moduleSet.board&&0!=o.boardDataCache.length){console.log("[%s] -----------\x3e cache to paint when canvas is ready",window.getTimeNow()),console.log("[%s] -----------\x3e cache : ",window.getTimeNow());for(var t=null,a=0,n=o.boardDataCache.length;a<n;a++){var s=o.boardDataCache.shift();console.log("        -----------\x3e %s",JSON.stringify(s)),"scroll"!=s.type?l.update(s):t=s}null!=t&&l.update(t)}}};t.dataGet=function(e,t){if(-1!=["course","user","host","url","boardSet","appointMemberList","courseAll","userAll"].indexOf(e)){var a=t;if("[object String]"==Object.prototype.toString.call(t)&&(a=JSON.parse(t)),"url"==e)try{a.pdf=window.MyBase64.decode(a.pdf),a.h5Course.countNum=parseInt(a.h5Course.countNum),a.h5Course.headUrl=window.MyBase64.decode(a.h5Course.headUrl),a.h5Course.urlControl=window.MyBase64.decode(a.h5Course.urlControl),console.log("[%s] -----------\x3e get URL data from client:",window.getTimeNow()),console.log("                      -----------\x3econtrolURL: %s",a.h5Course.urlControl),console.log("                      -----------\x3eheadSTR: %s",a.h5Course.headUrl),console.log("                      -----------\x3ecount page： %s",a.h5Course.countNum)}catch(e){}l.init(e,a)}else if("changeCourse"===e){window.iFrameParIO.changeCourse(JSON.parse(t));var a={type:"tools",jsonStr:JSON.stringify({type:"clear"})};l.update(a)}else if("testEncode"==e)console.log("===========test encode================>router enter:"),console.log(t),window.comm_type_send("testEncodeBack",t);else{var a={type:e,jsonStr:t};l.update(a)}}}),define("checkData",["boardConf","logicUnpack"],function(e,t,a){var o=e("boardConf").conf,n=e("logicUnpack"),r={route:function(e){n.dataGet(e.type,e.jsonStr)},checkInfo:function(e,t,a){setTimeout(function(){var o=e.shift();o&&t.call(a,o),e.length>0&&setTimeout(arguments.callee,50)},50)}};t.getCheckData=function(e,t){var a={type:e,jsonStr:t};"course"===e&&(o.course.localTime=(new Date).getTime()),o.serverIOArr.length>0?o.serverIOArr.push(a):(o.serverIOArr.push(a),r.checkInfo(o.serverIOArr,r.route))},t.getCheckDataEncode=function(e,t){var a={type:e,jsonStr:t};"course"===e&&(o.course.localTime=(new Date).getTime()),r.route(a)}}),define("boardConf",function(e,t,a){t.conf={serverIOArr:[],boardDataCache:[],isSupportEncodeFunc:!1,cToJsCacheArr:[],cToJsChildTaskEnd:!0,jsToCArr:[],jsToCTime:300,jsToCTimer:null,serverData:{objCourseInfo:null,objUserInfo:null,objHostInfo:null,objURLInfo:null},user:{type:"stu",userRole:"",userType:"",courseRole:"",userId:"",teaLogin:!1},course:{turnPage:!0,canDraw:!1,courseType:"1v1",courseId:"",metrialType:0,courseStyle:0,isMultiVC:!1,startedTime:0,localTime:0},host:{mainHost:"window",language:"cn",versionType:0,textType:"pdf",textUrl:{pdf:"",h5Course:{countNum:0,headUrl:"",urlControl:""}},classType:"normal",tipData:{scrollData:!1,fixedData:!1},tools:{pen:!1,signpen:!1,rec:!1,rub:!1,newrub:!1,text:!1,draft:!1,back:!1,clear:!1}},moduleSet:{contain:!0,update:!0,page:!1,tools:!1,board:!0,course:!0,dataScroll:!1,dataFixed:!1,ccLayer:!1,timeTip:!1,switch:!0},event:{mouse:!1,barScroll:!1,scrollData:!1,fixedData:!1,timeTip:!1},classInfo:{textInfo:{curPage:1,countPage:0,width:0,height:0},drawInfo:{width:0,height:0,left:0,top:0,ready:!1},serverInfo:{curPage:1,countPage:0},cursorStyle:{iframe:"",canvas:""}},update:{tip_update:!0},board:{version:"old",curToolType:"pen",pauseDraw:!0,mouse:{curX:0,curY:0,mouseMax:5,mouseSign:0},font:{big:32,small:25},tea:{type:"tea",pencil:{color:"#FF0000",size:3},sign_pencil:{color:"#FF0000",size:20},rub:{size:30},font:{fontStyle:"songti",fontSize:32,fontColor:"#FF0000"},target:{color:"#0000FF"}},stu:{type:"stu",pencil:{color:"#0078FF",size:3},sign_pencil:{color:"#FFFF00",size:20},rub:{size:30},font:{fontStyle:"songti",fontSize:32,fontColor:"#0078FF"},target:{color:"#0000FF"}}},cursor:{normal:{size:{wid:"46",hei:"46"},forbidden:"url(images/nor_forbid.png) 46 46,auto",normal:"url(images/nor_normal.png) 46 46,auto",ferule:'url("images/nor_ferule.png") 46 46,auto',pen:"url(images/nor_pen.png) 46 46,auto",signpen:"url(images/nor_signpen.png) 46 46,auto",rec:"url(images/nor_rec.png) 23 23,auto",rub:"url(images/nor_rub.png) 23 23,auto",newrub:"url(images/nor_newrub.png) 23 23,auto",text:"url(images/nor_text.png) 23 23,auto",draft:"url(images/nor_move.png) 23 23,auto",wait:""},teen:{size:{wid:"64",hei:"64"},forbidden:"url(images/young_forbid.png) 64 64,auto",normal:"url(images/young_normal.png) 64 64,auto",ferule:'url("images/young_ferule.png") 64 64,auto',pen:"url(images/young_pen.png) 64 64,auto",signpen:"url(images/young_signpen.png) 64 64,auto",rec:"url(images/young_rec.png) 32 32,auto",rub:"url(images/young_rub.png) 64 64,auto",newrub:"url(images/young_rub.png) 64 64,auto",text:"url(images/young_text.png) 32 32,auto",draft:"url(images/young_move.png) 64 64,auto",wait:"url(images/young_wait.png) 32 32,auto"}},pdf:{curPage:1,countPage:0},h5Course:{idType:400,open:!1,curPage:1,countPage:0,startClass:!1,startPractice:!1,resizeFirst:!0,canvasColor:"rgba(202, 232, 174, 0.2)"}}}),define("commCef",["boardConf","checkData"],function(e,t,a){function o(e,t,a){n.cToJsChildTaskEnd=!1;var s=0,i=0,t=t,a=a,c=[],l=0,d=[],u=0,p=-1,f=!1,g=!1;void 0==e?(c=n.cToJsCacheArr.splice(0),t=0,a=0):c=e,l=c.length;var h="",m=null;try{for(s=t;s<l;s++){for(p=c[s].dataIndex,console.log("===========test encode================>consumeServerData 当前执行:"),console.log(p),f=!0,d=JSON.parse(MyBase64.decode(c[s].data)),f=!1,u=d.length,i=a;i<u;i++)if(h=d[i].type,m=d[i].value,console.log("~~~~~~~"+p+"~~~~~~~~~~~~"+i+"~~~~~~~~~~"),void 0!=h&&void 0!=m)r.getCheckDataEncode(h,m);else{if(void 0==h)throw"type is undefined!";if(void 0==m)throw"value is undefined!"}a=0,g=!0,window.comm_type_get_encode_back&&window.comm_type_get_encode_back("complete",JSON.stringify({index:p})),g=!1}}catch(e){if(console.warn("|-------------consumeServerData----------\x3e消费服务器数据时出错!"),console.warn(e),f)return console.log("===========test encode================>consumeServerData Base64出错"),window.comm_type_get_encode_back&&window.comm_type_get_encode_back("BaseError",JSON.stringify({index:p,errorInfo:e})),window.comm_type_get_encode_back&&window.comm_type_get_encode_back("complete",JSON.stringify({index:p})),o(c.slice(0),++s,i);if(!g)return console.log("===========test encode================>consumeServerData 处理数据出错"),window.comm_type_get_encode_back&&window.comm_type_get_encode_back("DataError",JSON.stringify({index:p,errorInfo:e,errorPosition:i})),o(c.slice(0),s,++i);console.log("===========test encode================>consumeServerData 其他错误！")}console.log("!!!!!!!!!!!!!!test encode!!!!!!!!!!!!!!!!!!!!!!!!>consumeServerData 结束一次！"),n.cToJsCacheArr.length>0?o():(console.log("===========test encode================>consumeServerData 运行完，重设task状态！"),n.cToJsChildTaskEnd=!0)}var n=e("boardConf").conf,r=e("checkData");window.comm_type_get=function(e,t){console.log("client->js:",e,t),r.getCheckData(e,t)},window.comm_type_get_encode=function(e,t){try{console.log("client->js:",e,t),n.cToJsCacheArr.push({dataIndex:e,data:t}),console.log("===========test encode================>comm_type_get_encode enter:"),console.log(n.cToJsCacheArr.length),n.cToJsChildTaskEnd?(console.log("===========test encode================>comm_type_get_encode 上次任务已经结束:"),o()):console.log("===========test encode================>comm_type_get_encode 上次任务尚未结束:")}catch(e){console.warn("|-------------comm_type_get_encode----------\x3e消费服务器数据时出错!"),console.warn(e)}},window.comm_type_send=function(e,t){try{if(console.log("js->client:",e,t),"mac"===n.host.mainHost)return void window.webkit.messageHandlers.AcJs_get.postMessage(JSON.stringify({type:e,value:t}));n.isSupportEncodeFunc?(n.jsToCArr.push({type:e,value:JSON.parse(t)}),null==n.jsToCTimer&&(n.jsToCTimer=window.setTimeout(function(){try{var e=JSON.stringify(n.jsToCArr.splice(0));window.AcJs_get_encode(e)}catch(e){console.warn("|-------------AcJs_get_encode----------\x3e发送到C++时出错!"),console.warn(e)}finally{window.clearTimeout(n.jsToCTimer),n.jsToCTimer=null}},n.jsToCTime))):window.AcJs_get(e,t)}catch(e){console.log("[%s] -----\x3e failed to send data to cef3 : [%s]",window.getTimeNow(),e)}}}),$(document).ready(function(){window.MyBase64={table:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],UTF16ToUTF8:function(e){for(var t=[],a=e.length,o=0;o<a;o++){var n=e.charCodeAt(o);if(n>0&&n<=127)t.push(e.charAt(o));else if(n>=128&&n<=2047){var r=192|n>>6&31,s=128|63&n;t.push(String.fromCharCode(r),String.fromCharCode(s))}else if(n>=2048&&n<=65535){var r=224|n>>12&15,s=128|n>>6&63,i=128|63&n;t.push(String.fromCharCode(r),String.fromCharCode(s),String.fromCharCode(i))}}return t.join("")},UTF8ToUTF16:function(e){for(var t=[],a=e.length,o=0,o=0;o<a;o++){var n=e.charCodeAt(o);if(0==(n>>7&255))t.push(e.charAt(o));else if(6==(n>>5&255)){var r=e.charCodeAt(++o),s=(31&n)<<6,i=63&r,c=s|i;t.push(String.fromCharCode(c))}else if(14==(n>>4&255)){var r=e.charCodeAt(++o),l=e.charCodeAt(++o),s=n<<4|r>>2&15,i=(3&r)<<6|63&l;c=(255&s)<<8|i,t.push(String.fromCharCode(c))}}return t.join("")},encode:function(e){if(!e)return"";for(var t=this.UTF16ToUTF8(e),a=0,o=t.length,n=[];a<o;){var r=255&t.charCodeAt(a++);if(n.push(this.table[r>>2]),a==o){n.push(this.table[(3&r)<<4]),n.push("==");break}var s=t.charCodeAt(a++);if(a==o){n.push(this.table[(3&r)<<4|s>>4&15]),n.push(this.table[(15&s)<<2]),n.push("=");break}var i=t.charCodeAt(a++);n.push(this.table[(3&r)<<4|s>>4&15]),n.push(this.table[(15&s)<<2|(192&i)>>6]),n.push(this.table[63&i])}return n.join("")},decode:function(e){if(!e)return"";for(var t=e.length,a=0,o=[];a<t;)code1=this.table.indexOf(e.charAt(a++)),code2=this.table.indexOf(e.charAt(a++)),code3=this.table.indexOf(e.charAt(a++)),code4=this.table.indexOf(e.charAt(a++)),c1=code1<<2|code2>>4,c2=(15&code2)<<4|code3>>2,c3=(3&code3)<<6|code4,o.push(String.fromCharCode(c1)),64!=code3&&o.push(String.fromCharCode(c2)),64!=code4&&o.push(String.fromCharCode(c3));return this.UTF8ToUTF16(o.join(""))}},window.getTimeNow=function(){var e=new Date;return e.toLocaleTimeString()+" "+e.getMilliseconds()+"ms"},seajs.use("commCef")});